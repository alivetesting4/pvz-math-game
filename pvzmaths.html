<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>æ¤ç‰©å¤§æˆ°æ®­å± - ä¹ä¹ä¹˜æ³•è¡¨éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #10b981; }
            50% { box-shadow: 0 0 20px #10b981, 0 0 30px #10b981; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes bossGlow {
            0%, 100% { box-shadow: 0 0 10px #dc2626, 0 0 20px #dc2626; }
            50% { box-shadow: 0 0 30px #dc2626, 0 0 50px #dc2626, 0 0 70px #dc2626; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes rescueGlow {
            0%, 100% { box-shadow: 0 0 10px #fbbf24, 0 0 20px #fbbf24; }
            50% { box-shadow: 0 0 30px #fbbf24, 0 0 50px #fbbf24, 0 0 70px #fbbf24; }
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }        
        .bounce { animation: bounce 0.6s; }
        .shake { animation: shake 0.5s; }
        .glow { animation: glow 1s infinite; }
        .fadeInUp { animation: fadeInUp 0.8s ease-out; }
        .slideInLeft { animation: slideInLeft 0.8s ease-out; }
        .slideInRight { animation: slideInRight 0.8s ease-out; }
        .pulse { animation: pulse 2s infinite; }
        .bossGlow { animation: bossGlow 1.5s infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .rescueGlow { animation: rescueGlow 1.5s infinite; }
        .plant-bg { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .zombie-bg { background: linear-gradient(135deg, #dc2626, #991b1b); }
        .boss-bg { background: linear-gradient(135deg, #7c2d12, #451a03); }
        .final-boss-bg { background: linear-gradient(135deg, #1e1b4b, #0f0a19); }
        .rescue-bg { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        /* iOS/iPad viewport and text sizing fixes */
        html { -webkit-text-size-adjust: 100%; }
        html, body { height: 100%; }
        body { min-height: 100svh; }
        @supports (height: 100dvh) {
            body { min-height: 100dvh; }
        }
        @media (min-width: 768px) and (max-width: 1024px) {
            /* Slightly tighten paddings on iPad */
            #gameArea, #modeSelection, #difficultySelection, #transitionScreen, #rescueScreen, #gameOverScreen { padding: 1.5rem; }
            body { overflow: hidden; }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-green-400 via-green-500 to-green-600">
    <!-- éŠæˆ²æ¨™é¡Œ -->
    <div class="text-center py-6">
        <h1 class="text-4xl font-bold text-white mb-2">ğŸŒ» æ¤ç‰©å¤§æˆ°æ®­å± ğŸ§Ÿâ€â™‚ï¸</h1>
        <h2 class="text-2xl font-semibold text-yellow-200" id="gameSubtitle">æ•¸å­¸å¤§ä½œæˆ° (ver 1.2.1)</h2>
    </div>

    <!-- éŠæˆ²ç‹€æ…‹æ¬„ -->
    <div class="max-w-4xl mx-auto px-4 mb-6">
        <div class="bg-white/90 rounded-lg p-4 shadow-lg">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div class="flex items-center space-x-4">
                    <div class="text-lg font-bold text-green-700">
                        ğŸŒ± åˆ†æ•¸: <span id="score" class="text-2xl">0</span>
                    </div>
                    <div class="text-lg font-bold text-blue-700">
                        â° æ™‚é–“: <span id="timer" class="text-2xl">30</span>ç§’
                    </div>
                    <div class="text-lg font-bold text-purple-700">
                        ğŸ¯ é—œå¡: <span id="questionCount" class="text-2xl">1</span>
                    </div>
                    <div class="text-lg font-bold text-red-700">
                        ğŸ§Ÿâ€â™‚ï¸ æ®­å±: <span id="zombieCount" class="text-2xl">3</span>éš»
                    </div>
                    <div class="text-lg font-bold text-orange-700">
                        ğŸ”¥ é€£æ“Š: <span id="streakCount" class="text-2xl">0</span>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="restartBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-700 transition-all">
                        ğŸ”„ é‡æ–°é–‹å§‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²ä¸»å€åŸŸ -->
    <div class="max-w-4xl mx-auto px-4">
        <!-- éŠæˆ²å€åŸŸ -->
            <!-- æ¨¡å¼é¸æ“‡ç•«é¢ -->
            <div id="modeSelection" class="bg-white/95 rounded-xl p-8 shadow-2xl text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">ğŸ® é¸æ“‡éŠæˆ²æ¨¡å¼</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <button id="multiplicationMode" class="mode-btn bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-xl text-xl font-bold hover:from-blue-600 hover:to-purple-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">âœ–ï¸</div>
                    <div class="text-2xl mb-2">ä¹ä¹ä¹˜æ³•è¡¨</div>
                    <div class="text-sm opacity-90">æŒ‘æˆ°ä¹˜æ³•é‹ç®—</div>
                </button>
                <button id="divisionMode" class="mode-btn bg-gradient-to-r from-yellow-500 to-orange-600 text-white p-6 rounded-xl text-xl font-bold hover:from-yellow-600 hover:to-orange-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">â—</div>
                    <div class="text-2xl mb-2">ç™¾å…§æ•¸é™¤æ³•</div>
                    <div class="text-sm opacity-90">æŒ‘æˆ°é™¤æ³•é‹ç®—</div>
                </button>                
                <button id="addSubMode" class="mode-btn bg-gradient-to-r from-green-500 to-teal-600 text-white p-6 rounded-xl text-xl font-bold hover:from-green-600 hover:to-teal-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">â•â–</div>
                    <div class="text-2xl mb-2">å–®ä½æ•¸åŠ æ¸›</div>
                    <div class="text-sm opacity-90">ç·´ç¿’åŠ æ¸›é‹ç®—</div>
                </button>
                <button id="mixedMode" class="mode-btn bg-gradient-to-r from-red-500 to-pink-600 text-white p-6 rounded-xl text-xl font-bold hover:from-red-600 hover:to-pink-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸ¯</div>
                    <div class="text-2xl mb-2">æ··åˆæ¨¡å¼</div>
                    <div class="text-sm opacity-90">çµ‚æ¥µæŒ‘æˆ°</div>
                </button>
            </div>
            <div class="text-gray-600">
                <p class="mb-2">ğŸŒŸ é¸æ“‡ä½ æƒ³è¦æŒ‘æˆ°çš„æ•¸å­¸æ¨¡å¼</p>
                <p>æ¯ç¨®æ¨¡å¼éƒ½æœ‰ç¨ç‰¹çš„Bosså’ŒæŒ‘æˆ°ï¼</p>
            </div>
        </div>

        <!-- é›£åº¦é¸æ“‡ç•«é¢ -->
        <div id="difficultySelection" class="bg-white/95 rounded-xl p-8 shadow-2xl text-center hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">âš”ï¸ é¸æ“‡é›£åº¦ç­‰ç´š</h2>
            <div class="text-lg text-gray-600 mb-8" id="selectedModeText">å·²é¸æ“‡ï¼šä¹ä¹ä¹˜æ³•è¡¨</div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <button id="easyDifficulty" class="difficulty-btn bg-gradient-to-r from-green-400 to-green-600 text-white p-6 rounded-xl text-xl font-bold hover:from-green-500 hover:to-green-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸŒ±</div>
                    <div class="text-2xl mb-2">ç°¡å–®</div>
                    <div class="text-sm opacity-90 mb-2">æ®­å±è¡€é‡ï¼š50</div>
                    <div class="text-xs opacity-80">æ®­å±æ²’æœ‰ç‰¹æ®ŠæŠ€èƒ½</div>
                </button>
                <button id="normalDifficulty" class="difficulty-btn bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-6 rounded-xl text-xl font-bold hover:from-yellow-500 hover:to-orange-600 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸŒ»</div>
                    <div class="text-2xl mb-2">æ™®é€š</div>
                    <div class="text-sm opacity-90 mb-2">æ®­å±è¡€é‡ï¼š75</div>
                    <div class="text-xs opacity-80">æ®­å±æœ‰åŸºæœ¬æŠ€èƒ½</div>
                </button>
                <button id="hardDifficulty" class="difficulty-btn bg-gradient-to-r from-red-500 to-purple-600 text-white p-6 rounded-xl text-xl font-bold hover:from-red-600 hover:to-purple-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸ”¥</div>
                    <div class="text-2xl mb-2">å›°é›£</div>
                    <div class="text-sm opacity-90 mb-2">æ®­å±è¡€é‡ï¼š100</div>
                    <div class="text-xs opacity-80">æ®­å±æŠ€èƒ½é »ç¹ç™¼å‹•</div>
                </button>
            </div>
            
            <div class="bg-gray-100 rounded-lg p-4 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-3">ğŸ§Ÿâ€â™‚ï¸ æ®­å±æŠ€èƒ½èªªæ˜</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-700">
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸ‘»</span>
                        <span>éš±èº«è¡“ï¼šéš±è—é¸é …</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸŒªï¸</span>
                        <span>æ··äº‚è¡“ï¼šæ‰“äº‚é †åº</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">â°</span>
                        <span>æ™‚é–“è©›å’’ï¼šæ¸›å°‘æ™‚é–“</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸ­</span>
                        <span>å½è£è¡“ï¼šæ”¹è®Šå¤–è§€</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">â„ï¸</span>
                        <span>å†°å‡è¡“ï¼šå‡çµé¸é …</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸŒ«ï¸</span>
                        <span>è‡´ç›²è¡“ï¼šæ¨¡ç³Šè¦–ç·š</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸŒ€</span>
                        <span>æ··æ·†è¡“ï¼šæ—‹è½‰é¸é …</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸª</span>
                        <span>åˆ†èº«è¡“ï¼šå‡é¸é …</span>
                    </div>
                </div>
            </div>
            
            <button id="backToModeBtn" class="bg-gray-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-gray-600 transition-all mr-4">
                â† è¿”å›æ¨¡å¼é¸æ“‡
            </button>
        </div>

        <div id="gameArea" class="bg-white/95 rounded-xl p-8 shadow-2xl hidden">
            <!-- è§’è‰²å€åŸŸ -->
            <div class="flex justify-between items-center mb-8">
                <div class="text-center">
                    <div class="text-6xl mb-2" id="plantChar">ğŸŒ»</div>
                    <div class="text-lg font-bold text-green-700" id="plantName">å®ˆè­·æ¤ç‰©</div>
                    <div class="w-32 h-4 bg-gray-300 rounded-full overflow-hidden">
                        <div id="plantHealth" class="h-full bg-green-500 transition-all duration-500" style="width: 100%"></div>
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="text-4xl font-bold text-gray-700 mb-4">VS</div>
                    <div class="text-lg text-gray-600">æ®­å±è»åœ˜</div>
                </div>
                
                <div class="text-center">
                    <div class="text-lg font-bold text-red-700 mb-2">æ•¸å­¸æ®­å±è»åœ˜</div>
                    <div id="zombieArmy" class="flex flex-wrap justify-center gap-2 mb-2">
                        <div class="zombie-unit text-4xl" data-health="100">ğŸ§Ÿâ€â™‚ï¸</div>
                        <div class="zombie-unit text-4xl" data-health="100">ğŸ§Ÿâ€â™€ï¸</div>
                        <div class="zombie-unit text-4xl" data-health="100">ğŸ‘»</div>
                    </div>
                    <div class="text-sm text-red-600" id="zombieStatus">3éš»æ®­å±å‰©é¤˜</div>
                </div>
            </div>

            <!-- é¡Œç›®å€åŸŸ -->
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4" id="questionTitle">ğŸ§® æ•¸å­¸æŒ‘æˆ°</h3>
                    <div class="text-4xl font-bold mb-4" id="question">5 + 3 = ?</div>
                    <div class="text-lg" id="questionHint">é¸æ“‡æ­£ç¢ºç­”æ¡ˆä¾†æ”»æ“Šæ®­å±ï¼</div>
                </div>
            </div>

            <!-- é¸é …å€åŸŸ -->
            <div id="optionsArea" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <!-- å‹•æ…‹ç”Ÿæˆé¸é …æŒ‰éˆ• -->
            </div>

            <!-- æŠ€èƒ½å€åŸŸ -->
            <div class="text-center mb-6">
                <div class="flex justify-center gap-4 flex-wrap">
                    <button id="ultimateBtn" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-3 rounded-xl text-lg font-bold shadow-2xl hover:from-yellow-500 hover:to-orange-600 transition-all glow transform hover:scale-105" disabled>
                        âš¡ é™½å…‰ç‚¸å½ˆ âš¡<br>
                        <span class="text-sm">å‰©é¤˜ <span id="ultimateCount">3</span> æ¬¡</span>
                    </button>
                    <button id="healBtn" class="bg-gradient-to-r from-pink-400 to-red-500 text-white px-6 py-3 rounded-xl text-lg font-bold shadow-2xl hover:from-pink-500 hover:to-red-600 transition-all transform hover:scale-105" disabled>
                        ğŸ’– æ²»ç™‚è¡“ ğŸ’–<br>
                        <span class="text-sm">å‰©é¤˜ <span id="healCount">5</span> æ¬¡</span>
                    </button>
                </div>
            </div>

            <!-- éŠæˆ²è¨Šæ¯ -->
            <div id="gameMessage" class="text-center text-lg font-bold h-8"></div>
        </div>

        <!-- éå ´å‹•ç•«ç•«é¢ -->
        <div id="transitionScreen" class="bg-gradient-to-b from-purple-900 via-blue-900 to-black rounded-xl p-8 shadow-2xl text-center hidden">
            <div class="text-8xl mb-6 pulse" id="transitionEmoji">ğŸŒŸ</div>
            <h2 class="text-4xl font-bold text-white mb-4 fadeInUp" id="transitionTitle">é—œå¡å®Œæˆï¼</h2>
            <div class="text-2xl text-yellow-300 mb-6 slideInLeft" id="transitionMessage">æº–å‚™è¿æ¥ä¸‹ä¸€æ³¢æŒ‘æˆ°ï¼</div>
            <div class="text-lg text-gray-300 slideInRight" id="transitionHint">æ–°çš„æ•µäººæ­£åœ¨é€¼è¿‘...</div>
        </div>

        <!-- æ‹¯æ•‘æˆ´å¤«é—œå¡ç•«é¢ -->
        <div id="rescueScreen" class="rescue-bg rounded-xl p-8 shadow-2xl text-center hidden">
            <div class="text-8xl mb-6 float rescueGlow">ğŸ§‘â€ğŸŒ¾</div>
            <h2 class="text-4xl font-bold text-white mb-4 fadeInUp">æ‹¯æ•‘æˆ´å¤«ï¼</h2>
            <div class="text-2xl text-yellow-100 mb-6 slideInLeft">æˆ´å¤«è¢«æ±½çƒæ®­å±æŠ“èµ°äº†ï¼</div>
            <div class="text-lg text-yellow-200 mb-8 slideInRight">å¿«é€Ÿç­”å°é¡Œç›®ä¾†æ‹¯æ•‘ä»–ï¼</div>
            <div class="bg-white/20 rounded-lg p-4 mb-6">
                <div class="text-xl font-bold text-white mb-2">ğŸˆ æ±½çƒæ®­å±è¡€é‡ï¼š<span id="balloonZombieHealth">150</span></div>
                <div class="w-full h-4 bg-gray-700 rounded-full overflow-hidden">
                    <div id="balloonHealthBar" class="h-full bg-red-500 transition-all duration-500" style="width: 100%"></div>
                </div>
            </div>
        </div>

        <!-- éŠæˆ²çµæŸç•«é¢ -->
        <div id="gameOverScreen" class="bg-white/95 rounded-xl p-8 shadow-2xl text-center hidden">
            <div class="text-6xl mb-4" id="gameOverEmoji">ğŸ‰</div>
            <h2 class="text-3xl font-bold mb-4" id="gameOverTitle">éŠæˆ²çµæŸï¼</h2>
            <div class="text-xl mb-6" id="finalScore">æœ€çµ‚åˆ†æ•¸: 0</div>
            <div class="text-lg mb-6" id="gameOverMessage">ä½ æˆåŠŸä¿è­·äº†èŠ±åœ’ï¼</div>
            <button id="playAgainBtn" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-3 rounded-xl text-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all shadow-lg">
                ğŸŒ± å†ç©ä¸€æ¬¡
            </button>
        </div>
        </div>
    </div>

    <script>
        class MathZombieGame {
            constructor() {
                this.score = 0;
                this.timeLeft = 30;
                this.level = 1;
                this.ultimateSkills = 3;
                this.healSkills = 5;
                this.currentAnswer = 0;
                this.plantHealth = 100;
                this.gameActive = false;
                this.timer = null;
                this.zombieArmy = [];
                this.optionCount = 4; // åˆå§‹é¸é …æ•¸é‡
                this.gameMode = null; // 'multiplication', 'addSub', 'mixed'
                this.difficulty = null; // 'easy', 'normal', 'hard'
                this.zombieSkillTimer = null;
                this.hiddenOptions = [];
                this.questionTimer = null;
                this.questionStartTime = 0;
                this.correctStreak = 0; // é€£çºŒç­”å°æ¬¡æ•¸
                this.currentQuestionType = 'math'; // 'math' or 'text'
                this.textQuestions = []; // æ–‡å­—é¡Œåº«
                this.isRescueLevel = false; // æ˜¯å¦ç‚ºæ‹¯æ•‘é—œå¡
                this.balloonZombieHealth = 150; // æ±½çƒæ®­å±è¡€é‡
                this.englishModeActive = false; // è‹±æ–‡ä½œç­”æ¨¡å¼
                this.originalOptionsBackup = null;
                this.currentAnswerBackup = null;
                this.isSecretLevel = false; // ç§˜å¯†é—œå¡
                this.englishifyUnlocked = false; // æ‰“æ•—æ®­å±å¤§éš»ä½¬å¾Œè§£é–
                this.currentBossIsBigGuy = false; // æœ¬å›åˆBossæ˜¯å¦ç‚ºæ®­å±å¤§éš»ä½¬
                this.originalHint = "é¸æ“‡æ­£ç¢ºç­”æ¡ˆä¾†æ”»æ“Šæ®­å±ï¼";
                
                // å®Œæ•´æ¤ç‰©åˆ—è¡¨
                this.plants = {
                    'å‘æ—¥è‘µ': { emoji: 'ğŸŒ»', skill: 'ç”¢ç”Ÿé™½å…‰', color: 'yellow' },
                    'é™½å…‰è‡': { emoji: 'ğŸ„', skill: 'å¤œé–“ç”¢é™½å…‰', color: 'orange' },
                    'é›™å‘æ—¥è‘µ': { emoji: 'ğŸŒ»ğŸŒ»', skill: 'é›™å€é™½å…‰', color: 'gold' },
                    'è±Œè±†å°„æ‰‹': { emoji: 'ğŸŸ¢', skill: 'ç™¼å°„è±Œè±†', color: 'green' },
                    'é›™ç™¼å°„æ‰‹': { emoji: 'ğŸŸ¢ğŸŸ¢', skill: 'é›™ç™¼è±Œè±†', color: 'lime' },
                    'ä¸‰é‡å°„æ‰‹': { emoji: 'ğŸŸ¢ğŸŸ¢ğŸŸ¢', skill: 'ä¸‰ç™¼è±Œè±†', color: 'emerald' },
                    'å¯’å†°å°„æ‰‹': { emoji: 'â„ï¸', skill: 'å†°å‡æ”»æ“Š', color: 'blue' },
                    'ç«ç‚¬æ¨': { emoji: 'ğŸ”¥', skill: 'é»ç‡ƒè±Œè±†', color: 'red' },
                    'è¥¿ç“œæŠ•æ‰‹': { emoji: 'ğŸ‰', skill: 'é‡å‹æ”»æ“Š', color: 'pink' },
                    'å†°è¥¿ç“œæŠ•æ‰‹': { emoji: 'ğŸ§ŠğŸ‰', skill: 'å†°å‡é‡æ“Š', color: 'cyan' },
                    'ç‰ç±³æŠ•æ‰‹': { emoji: 'ğŸŒ½', skill: 'é»ƒæ²¹çœ©æšˆ', color: 'yellow' },
                    'çˆ†ç‚¸æ«»æ¡ƒ': { emoji: 'ğŸ’', skill: 'ç¯„åœçˆ†ç‚¸', color: 'red' },
                    'è¾£æ¤’': { emoji: 'ğŸŒ¶ï¸', skill: 'ä¸€æ’æ”»æ“Š', color: 'orange' },
                    'å …æœç‰†': { emoji: 'ğŸ¥œ', skill: 'é˜²ç¦¦é˜»æ“‹', color: 'brown' },
                    'é«˜å …æœç‰†': { emoji: 'ğŸ°', skill: 'é«˜ç´šé˜²ç¦¦', color: 'gray' },
                    'å—ç“œé ­': { emoji: 'ğŸƒ', skill: 'ä¿è­·æ¤ç‰©', color: 'orange' },
                    'åœ°åˆº': { emoji: 'âš¡', skill: 'åœ°é¢æ”»æ“Š', color: 'purple' },
                    'åœ°åˆºç‹': { emoji: 'ğŸ‘‘âš¡', skill: 'å¼·åŠ›åœ°åˆº', color: 'violet' },
                    'å¤§è’œ': { emoji: 'ğŸ§„', skill: 'æ”¹è®Šè·¯ç·š', color: 'white' },
                    'ç£éµè‡': { emoji: 'ğŸ§²', skill: 'å¸å–é‡‘å±¬', color: 'silver' },
                    'å†°å‡è˜‘è‡': { emoji: 'ğŸ§ŠğŸ„', skill: 'å…¨å ´å†°å‡', color: 'blue' },
                    'æ¨¡ä»¿è€…': { emoji: 'ğŸ­', skill: 'è¤‡è£½æ¤ç‰©', color: 'indigo' },
                    'å°å™´è‡': { emoji: 'ğŸ„ğŸ’¨', skill: 'çŸ­ç¨‹æ”»æ“Š', color: 'gray' },
                    'å¤§å™´è‡': { emoji: 'ğŸ„ğŸ’¨ğŸ’¨', skill: 'ä¸­ç¨‹æ”»æ“Š', color: 'slate' },
                    'é­…æƒ‘è‡': { emoji: 'ğŸ’œğŸ„', skill: 'æ§åˆ¶æ®­å±', color: 'purple' },
                    'å’–å•¡è±†': { emoji: 'â˜•', skill: 'å–šé†’è˜‘è‡', color: 'amber' },
                    'é¦™è’²': { emoji: 'ğŸŒ¾', skill: 'æ°´ä¸­æ”»æ“Š', color: 'teal' },
                    'çˆ†ç±³èŠ±æ©Ÿ': { emoji: 'ğŸ¿', skill: 'é€£çºŒç™¼å°„', color: 'yellow' },
                    'è£‚èšå°„æ‰‹': { emoji: 'ğŸŸ¢ğŸ’¥', skill: 'å¾Œæ–¹æ”»æ“Š', color: 'green' },
                    'èœå•': { emoji: 'ğŸ¥¬', skill: 'å•è™Ÿæ•ˆæœ', color: 'green' },
                    'é‡‘ç›èŠ±': { emoji: 'ğŸŒ¼', skill: 'ç”¢ç”Ÿé‡‘å¹£', color: 'gold' },
                    'èŠ¥æœ«ç‚¸å½ˆ': { emoji: 'ğŸ’›ğŸ’¥', skill: 'é»ƒè‰²çˆ†ç‚¸', color: 'yellow' },
                    'ç«é¾è‰': { emoji: 'ğŸ²ğŸ”¥', skill: 'ç«ç„°æ”»æ“Š', color: 'red' },
                    'ç«¹ç«¿è·³èºè€…ï¼ˆæ¤ç‰©ç‰ˆï¼‰': { emoji: 'ğŸ‹', skill: 'è·³èºæ”»æ“Š', color: 'green' },
                    'è˜‘è‡ç‚¸å½ˆ': { emoji: 'ğŸ„ğŸ’¥', skill: 'è˜‘è‡çˆ†ç‚¸', color: 'brown' },
                    'è·è‘‰': { emoji: 'ğŸª·', skill: 'æ°´ä¸Šå¹³å°', color: 'green' },
                    'ç¡è“®': { emoji: 'ğŸŒ¸ğŸª·', skill: 'ç¾éº—å¹³å°', color: 'pink' },
                    'é˜²è­·è˜‘è‡': { emoji: 'ğŸ›¡ï¸ğŸ„', skill: 'é˜²è­·ç½©', color: 'blue' },
                    'åœ°é›·': { emoji: 'ğŸ’£', skill: 'è¸©çˆ†æ”»æ“Š', color: 'black' },
                    'è˜‘è‡ç‡ˆ': { emoji: 'ğŸ„ğŸ’¡', skill: 'ç…§æ˜é™¤éœ§', color: 'yellow' },
                    'è˜‘è‡ç›¾': { emoji: 'ğŸ„ğŸ›¡ï¸', skill: 'è˜‘è‡é˜²ç¦¦', color: 'gray' }
                };
                
                this.currentPlant = null;
                this.currentPlantName = null;
                this.zombieTypes = ['ğŸ§Ÿâ€â™‚ï¸', 'ğŸ§Ÿâ€â™€ï¸', 'ğŸ‘»', 'ğŸ’€', 'ğŸƒ', 'ğŸ‘¹', 'ğŸ¤–', 'ğŸ‘¾', 'ğŸ¦‡', 'ğŸˆ'];
                this.bossTypes = {
                    3: { emoji: 'ğŸ§ª', name: 'æ®­å±åšå£«', health: 200},
                    5: { emoji: 'ğŸ¦¸â€â™‚ï¸', name: 'è¶…äººæ®­å±', health: 250},
                    7: { emoji: 'ğŸ’ªğŸ§Ÿ', name: 'æ®­å±å¤§éš»ä½¬', health: 300},
                    //7: { emoji: 'âš¡', name: 'é›·é›»æ®­å±', health: 300 },
                    9: { emoji: 'âš¡â„ï¸', name: 'é›·é›»å†°éœœæ®­å±', health: 350 },
                    10: { emoji: 'ğŸ’€', name: 'çµ‚æ¥µé­”ç‹', health: 500 },
                    13: { emoji: 'ğŸ”¥ğŸ‘‘', name: 'ç†”å²©å¸ç‹æ®­å±', health: 400 },
                    15: { emoji: 'ğŸŒªï¸ğŸ§Ÿâ€â™‚ï¸', name: 'ç©¶æ¥µé ˜ä¸»æ®­å±', health: 600 }
                };
                this.balloonZombie = { emoji: 'ğŸˆ', name: 'æ±½çƒæ®­å±', health: 150 };
                this.difficultySettings = {
                    easy: { zombieHealth: 50, bossHealthMultiplier: 0.6, skillChance: 0 },
                    normal: { zombieHealth: 75, bossHealthMultiplier: 0.8, skillChance: 0.3 },
                    hard: { zombieHealth: 100, bossHealthMultiplier: 1.0, skillChance: 0.6 }
                };
                
                // åˆå§‹åŒ–æ–‡å­—é¡Œåº«
                this.initializeTextQuestions();
                this.optionColors = [
                    'from-green-400 to-green-500 hover:from-green-500 hover:to-green-600',
                    'from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600',
                    'from-purple-400 to-purple-500 hover:from-purple-500 hover:to-purple-600',
                    'from-pink-400 to-pink-500 hover:from-pink-500 hover:to-pink-600',
                    'from-red-400 to-red-500 hover:from-red-500 hover:to-red-600',
                    'from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600',
                    'from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600',
                    'from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600'
                ];
                
                this.bindModeSelection();
            }
            initializeTextQuestions() {
                this.textQuestions = {
                    multiplication: [
                      { question: "å‘æ—¥è‘µç¨®äº† 6 æ’ï¼Œæ¯æ’ 7 æ£µï¼Œä¸€å…±å¤šå°‘æ£µï¼Ÿ", answer: 42, options: [35, 42, 48, 49] },
                      { question: "è±Œè±†å°„æ‰‹æ¯æ¬¡ç™¼å°„ 8 é¡†è±Œè±†ï¼Œé€£çºŒå°„äº† 9 æ¬¡ï¼Œä¸€å…±å°„äº†å¤šå°‘é¡†ï¼Ÿ", answer: 72, options: [63, 72, 81, 64] },
                      { question: "å …æœç‰†æœ‰ 4 å±¤ï¼Œæ¯å±¤ 6 å¡Šï¼Œä¸€å…±å¤šå°‘å¡Šå …æœç‰†ï¼Ÿ", answer: 24, options: [20, 24, 28, 30] },
                      { question: "å¯’å†°å°„æ‰‹ä¸€æ¬¡å°„å‡º 7 é¡†å†°çƒï¼Œå°„äº† 5 æ¬¡ï¼Œä¸€å…±å°„äº†å¤šå°‘é¡†ï¼Ÿ", answer: 35, options: [30, 35, 40, 32] },
                      { question: "ç«ç‚¬æ¨æ¯æ¬¡ç‡’æ‰ 9 éš»æ®­å±ï¼Œç‡’äº† 4 æ¬¡ï¼Œä¸€å…±ç‡’æ‰å¤šå°‘éš»ï¼Ÿ", answer: 36, options: [32, 36, 40, 45] },
                      { question: "ä¸‰é‡å°„æ‰‹ä¸€æ¬¡ç™¼å°„ 3 é¡†è±Œè±†ï¼Œé€£çºŒå°„äº† 8 æ¬¡ï¼Œä¸€å…±å°„äº†å¤šå°‘é¡†ï¼Ÿ", answer: 24, options: [21, 24, 27, 32] },
                      { question: "ç‰ç±³æŠ•æ‰‹ä¸€æ¬¡ä¸Ÿ 6 é¡†ç‰ç±³ï¼Œä¸Ÿäº† 9 æ¬¡ï¼Œä¸€å…±ä¸Ÿäº†å¤šå°‘ï¼Ÿ", answer: 54, options: [48, 54, 63, 56] },
                      { question: "å¤§å˜´èŠ±åƒæ‰ 7 éš»æ®­å±ï¼Œæ¯éš»æ®­å±å€¼ 7 åˆ†ï¼Œä¸€å…±å¾—å¤šå°‘åˆ†ï¼Ÿ", answer: 49, options: [42, 49, 56, 48] },
                      { question: "åœ°åˆºä¸€æ¬¡åˆºç©¿ 5 éš»æ®­å±ï¼Œåˆºäº† 6 æ¬¡ï¼Œä¸€å…±åˆºç©¿å¤šå°‘éš»ï¼Ÿ", answer: 30, options: [25, 30, 35, 40] },
                      { question: "é«˜å …æœç‰†æœ‰ 3 å±¤ï¼Œæ¯å±¤ 8 å¡Šï¼Œä¸€å…±å¤šå°‘å¡Šï¼Ÿ", answer: 24, options: [20, 24, 28, 32] },
                      { question: "å‘æ—¥è‘µæ¯å¤©ç”¢å‡º 4 é¡†é™½å…‰ï¼Œé€£çºŒ 7 å¤©ï¼Œä¸€å…±ç”¢å‡ºå¤šå°‘ï¼Ÿ", answer: 28, options: [24, 28, 32, 30] },
                      { question: "çˆ†ç‚¸æ«»æ¡ƒç‚¸æ‰ 6 çµ„æ®­å±ï¼Œæ¯çµ„æœ‰ 5 éš»ï¼Œä¸€å…±ç‚¸æ‰å¤šå°‘ï¼Ÿ", answer: 30, options: [25, 30, 35, 40] },
                      { question: "è¾£æ¤’ç‡’æ‰ 1 æ’æ®­å±ï¼Œæ¯æ’æœ‰ 9 éš»ï¼Œä¸€å…±ç‡’æ‰å¤šå°‘ï¼Ÿ", answer: 9, options: [8, 9, 10, 12] },
                      { question: "å—ç“œé ­ä¿è­·äº† 4 æ£µæ¤ç‰©ï¼Œæ¯æ£µæ¤ç‰©ä¿è­· 6 æ¬¡ï¼Œä¸€å…±ä¿è­·å¤šå°‘æ¬¡ï¼Ÿ", answer: 24, options: [20, 24, 28, 30] },
                      { question: "ç£éµè‡å¸èµ° 5 å€‹éµæ¡¶æ®­å±ï¼Œæ¯å€‹å€¼ 10 åˆ†ï¼Œä¸€å…±å¾—å¤šå°‘åˆ†ï¼Ÿ", answer: 50, options: [40, 50, 60, 70] },
                      { question: "é¦™è’²ä¸€æ¬¡å°„å‡º 6 æ ¹ç®­ï¼Œå°„äº† 7 æ¬¡ï¼Œä¸€å…±å°„äº†å¤šå°‘ï¼Ÿ", answer: 42, options: [36, 42, 48, 40] },
                      { question: "åœ°é›·ç‚¸æ‰ 3 çµ„æ®­å±ï¼Œæ¯çµ„ 8 éš»ï¼Œä¸€å…±ç‚¸æ‰å¤šå°‘ï¼Ÿ", answer: 24, options: [21, 24, 27, 30] },
                      { question: "å†°å‡è˜‘è‡å‡ä½ 4 æ’æ®­å±ï¼Œæ¯æ’ 9 éš»ï¼Œä¸€å…±å‡ä½å¤šå°‘ï¼Ÿ", answer: 36, options: [32, 36, 40, 45] },
                      { question: "é›™å‘å°„æ‰‹æ¯æ¬¡å°„ 2 é¡†è±Œè±†ï¼Œå°„äº† 10 æ¬¡ï¼Œä¸€å…±å°„äº†å¤šå°‘ï¼Ÿ", answer: 20, options: [18, 20, 22, 24] },
                      { question: "å¤§è’œè½‰ç§» 6 éš»æ®­å±ï¼Œæ¯éš»è½‰ç§» 2 æ¬¡ï¼Œä¸€å…±è½‰ç§»å¤šå°‘æ¬¡ï¼Ÿ", answer: 12, options: [10, 12, 14, 16] },
                      { question: "èˆç‹æ®­å±å¬å–šäº† 5 æ¬¡èˆä¼´ï¼Œæ¯æ¬¡ 4 éš»ï¼Œä¸€å…±å¬å–šå¤šå°‘ï¼Ÿ", answer: 20, options: [16, 20, 24, 18] },
                      { question: "å·¨äººæ®­å±æ®æ£’ 3 æ¬¡ï¼Œæ¯æ¬¡æ‰“å€’ 6 æ£µæ¤ç‰©ï¼Œä¸€å…±æ‰“å€’å¤šå°‘ï¼Ÿ", answer: 18, options: [15, 18, 21, 24] },
                      { question: "æˆ´å¤«ä¸Ÿå‡º 7 é¡†è¾£æ¤’ï¼Œæ¯é¡†ç‡’æ‰ 5 éš»æ®­å±ï¼Œä¸€å…±ç‡’æ‰å¤šå°‘ï¼Ÿ", answer: 35, options: [30, 35, 40, 45] },
                      { question: "é™½å…‰è‡ç”¢å‡º 4 é¡†é™½å…‰ï¼Œç”¢å‡º 8 æ¬¡ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 32, options: [28, 32, 36, 40] },
                      { question: "çˆ†ç±³èŠ±æ©Ÿä¸€æ¬¡çˆ†å‡º 6 é¡†çˆ†ç±³èŠ±ï¼Œçˆ†äº† 5 æ¬¡ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 30, options: [25, 30, 35, 40] },
                      { question: "å†°è¥¿ç“œæŠ•æ‰‹ä¸€æ¬¡ä¸Ÿ 9 é¡†å†°è¥¿ç“œï¼Œä¸Ÿäº† 3 æ¬¡ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 27, options: [24, 27, 30, 33] },
                      { question: "åœ°åˆºç‹ä¸€æ¬¡åˆºç©¿ 8 éš»æ®­å±ï¼Œåˆºäº† 6 æ¬¡ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 48, options: [42, 48, 54, 56] },
                      { question: "é«˜å …æœç‰†å‡ç´šäº† 5 æ¬¡ï¼Œæ¯æ¬¡å¢åŠ  4 å¡Šï¼Œä¸€å…±å¢åŠ å¤šå°‘ï¼Ÿ", answer: 20, options: [16, 20, 24, 28] },
                      { question: "å‘æ—¥è‘µåœ¨ 10 å¤©å…§æ¯å¤©ç”¢å‡º 3 é¡†é™½å…‰ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 30, options: [27, 30, 33, 36] },
                      { question: "æ®­å±åšå£«æ´¾å‡º 6 å°æ©Ÿå™¨ï¼Œæ¯å°æœ‰ 7 éš»æ®­å±ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 42, options: [36, 42, 48, 49] }
                    ],
                    division: [
                      { question: "å‘æ—¥è‘µç”¢å‡º 42 é¡†é™½å…‰ï¼Œå¹³å‡åˆ†çµ¦ 6 æ£µæ¤ç‰©ï¼Œæ¯æ£µåˆ†åˆ°å¤šå°‘ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "è±Œè±†å°„æ‰‹å°„å‡º 72 é¡†è±Œè±†ï¼Œå¹³å‡æ¯æ¬¡å°„ 8 é¡†ï¼Œä¸€å…±å°„äº†å¹¾æ¬¡ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] },
                      { question: "å …æœç‰†æœ‰ 24 å¡Šï¼Œå¹³å‡åˆ†æˆ 4 å±¤ï¼Œæ¯å±¤æœ‰å¤šå°‘å¡Šï¼Ÿ", answer: 6, options: [5, 6, 7, 8] },
                      { question: "å¯’å†°å°„æ‰‹å‡ä½ 35 éš»æ®­å±ï¼Œå¹³å‡æ¯æ¬¡å‡ä½ 5 éš»ï¼Œä¸€å…±å‡äº†å¹¾æ¬¡ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "ç«ç‚¬æ¨ç‡’æ‰ 36 éš»æ®­å±ï¼Œå¹³å‡æ¯æ¬¡ç‡’æ‰ 9 éš»ï¼Œä¸€å…±ç‡’äº†å¹¾æ¬¡ï¼Ÿ", answer: 4, options: [3, 4, 5, 6] },
                      { question: "ä¸‰é‡å°„æ‰‹å°„å‡º 24 é¡†è±Œè±†ï¼Œå¹³å‡æ¯æ¬¡å°„ 3 é¡†ï¼Œä¸€å…±å°„äº†å¹¾æ¬¡ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] },
                      { question: "ç‰ç±³æŠ•æ‰‹ä¸Ÿå‡º 54 é¡†ç‰ç±³ï¼Œå¹³å‡æ¯æ¬¡ä¸Ÿ 6 é¡†ï¼Œä¸€å…±ä¸Ÿäº†å¹¾æ¬¡ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] },
                      { question: "å¤§å˜´èŠ±åƒæ‰ 49 éš»æ®­å±ï¼Œå¹³å‡æ¯æ¬¡åƒ 7 éš»ï¼Œä¸€å…±åƒäº†å¹¾æ¬¡ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "åœ°åˆºåˆºç©¿ 30 éš»æ®­å±ï¼Œå¹³å‡æ¯æ¬¡åˆºç©¿ 5 éš»ï¼Œä¸€å…±åˆºäº†å¹¾æ¬¡ï¼Ÿ", answer: 6, options: [5, 6, 7, 8] },
                      { question: "é«˜å …æœç‰†æœ‰ 24 å¡Šï¼Œå¹³å‡åˆ†æˆ 3 å±¤ï¼Œæ¯å±¤æœ‰å¤šå°‘å¡Šï¼Ÿ", answer: 8, options: [6, 7, 8, 9] },
                      { question: "å‘æ—¥è‘µç”¢å‡º 28 é¡†é™½å…‰ï¼Œå¹³å‡æ¯å¤©ç”¢å‡º 4 é¡†ï¼Œä¸€å…±å¹¾å¤©ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "çˆ†ç‚¸æ«»æ¡ƒç‚¸æ‰ 30 éš»æ®­å±ï¼Œå¹³å‡æ¯æ¬¡ç‚¸æ‰ 6 éš»ï¼Œä¸€å…±ç‚¸äº†å¹¾æ¬¡ï¼Ÿ", answer: 5, options: [4, 5, 6, 7] },
                      { question: "è¾£æ¤’ç‡’æ‰ 9 éš»æ®­å±ï¼Œæ¯æ’æœ‰ 3 éš»ï¼Œä¸€å…±ç‡’äº†å¹¾æ’ï¼Ÿ", answer: 3, options: [2, 3, 4, 5] },
                      { question: "å—ç“œé ­ä¿è­· 24 æ¬¡ï¼Œå…±æœ‰ 4 æ£µæ¤ç‰©ï¼Œæ¯æ£µè¢«ä¿è­·å¹¾æ¬¡ï¼Ÿ", answer: 6, options: [5, 6, 7, 8] },
                      { question: "ç£éµè‡å¸èµ° 50 å€‹éµæ¡¶æ®­å±ï¼Œæ¯æ¬¡å¸ 10 å€‹ï¼Œä¸€å…±å¸äº†å¹¾æ¬¡ï¼Ÿ", answer: 5, options: [4, 5, 6, 7] },
                      { question: "é¦™è’²å°„å‡º 42 æ ¹ç®­ï¼Œæ¯æ¬¡å°„ 6 æ ¹ï¼Œä¸€å…±å°„äº†å¹¾æ¬¡ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "åœ°é›·ç‚¸æ‰ 24 éš»æ®­å±ï¼Œæ¯æ¬¡ç‚¸æ‰ 8 éš»ï¼Œä¸€å…±ç‚¸äº†å¹¾æ¬¡ï¼Ÿ", answer: 3, options: [2, 3, 4, 5] },
                      { question: "å†°å‡è˜‘è‡å‡ä½ 36 éš»æ®­å±ï¼Œæ¯æ¬¡å‡ä½ 4 æ’ï¼Œä¸€æ’æœ‰å¹¾éš»ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] },
                      { question: "é›™å‘å°„æ‰‹å°„å‡º 20 é¡†è±Œè±†ï¼Œæ¯æ¬¡å°„ 2 é¡†ï¼Œä¸€å…±å°„äº†å¹¾æ¬¡ï¼Ÿ", answer: 10, options: [9, 10, 11, 12] },
                      { question: "å¤§è’œè½‰ç§» 12 æ¬¡ï¼Œå…±æœ‰ 6 éš»æ®­å±ï¼Œæ¯éš»è¢«è½‰ç§»å¹¾æ¬¡ï¼Ÿ", answer: 2, options: [1, 2, 3, 4] },
                      { question: "èˆç‹æ®­å±å¬å–š 20 éš»èˆä¼´ï¼Œæ¯æ¬¡å¬å–š 4 éš»ï¼Œä¸€å…±å¬å–šå¹¾æ¬¡ï¼Ÿ", answer: 5, options: [4, 5, 6, 7] },
                      { question: "å·¨äººæ®­å±æ‰“å€’ 18 æ£µæ¤ç‰©ï¼Œæ¯æ¬¡æ‰“å€’ 6 æ£µï¼Œä¸€å…±æ‰“äº†å¹¾æ¬¡ï¼Ÿ", answer: 3, options: [2, 3, 4, 5] },
                      { question: "æˆ´å¤«ä¸Ÿå‡º 30 é¡†è¾£æ¤’ï¼Œæ¯æ¬¡ä¸Ÿ 5 é¡†ï¼Œä¸€å…±ä¸Ÿäº†å¹¾æ¬¡ï¼Ÿ", answer: 6, options: [5, 6, 7, 8] },
                      { question: "é™½å…‰è‡ç”¢å‡º 32 é¡†é™½å…‰ï¼Œæ¯æ¬¡ç”¢å‡º 4 é¡†ï¼Œä¸€å…±ç”¢å‡ºå¹¾æ¬¡ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] },
                      { question: "çˆ†ç±³èŠ±æ©Ÿçˆ†å‡º 30 é¡†çˆ†ç±³èŠ±ï¼Œæ¯æ¬¡çˆ†å‡º 6 é¡†ï¼Œä¸€å…±çˆ†äº†å¹¾æ¬¡ï¼Ÿ", answer: 5, options: [4, 5, 6, 7] },
                      { question: "å†°è¥¿ç“œæŠ•æ‰‹ä¸Ÿå‡º 27 é¡†å†°è¥¿ç“œï¼Œæ¯æ¬¡ä¸Ÿ 3 é¡†ï¼Œä¸€å…±ä¸Ÿäº†å¹¾æ¬¡ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] },
                      { question: "åœ°åˆºç‹åˆºç©¿ 48 éš»æ®­å±ï¼Œæ¯æ¬¡åˆºç©¿ 6 éš»ï¼Œä¸€å…±åˆºäº†å¹¾æ¬¡ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] },
                      { question: "é«˜å …æœç‰†å‡ç´š 20 æ¬¡ï¼Œæ¯æ¬¡å¢åŠ  4 å¡Šï¼Œä¸€å…±å¢åŠ å¤šå°‘å¡Šï¼Ÿ", answer: 80, options: [60, 70, 80, 90] },
                      { question: "å‘æ—¥è‘µåœ¨ 10 å¤©å…§ç”¢å‡º 30 é¡†é™½å…‰ï¼Œæ¯å¤©ç”¢å‡ºå¤šå°‘ï¼Ÿ", answer: 3, options: [2, 3, 4, 5] },
                      { question: "æ®­å±åšå£«æ´¾å‡º 42 éš»æ®­å±ï¼Œæ¯å°æ©Ÿå™¨æ´¾å‡º 6 éš»ï¼Œä¸€å…±æ´¾å‡ºå¹¾å°ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] }
                    ],
                    addSub: [
                      { question: "æ®­å±ä¾†äº† 8 éš»ï¼Œåˆä¾†äº† 7 éš»ï¼Œä¸€å…±å¤šå°‘éš»ï¼Ÿ", answer: 15, options: [14, 15, 16, 17] },
                      { question: "èŠ±åœ’è£¡åŸæœ¬æœ‰ 9 æ£µæ¤ç‰©ï¼Œè¢«åƒæ‰äº† 4 æ£µï¼Œé‚„å‰©å¤šå°‘æ£µï¼Ÿ", answer: 5, options: [4, 5, 6, 7] },
                      { question: "å …æœç‰†ä¿®å¾©äº† 6 å¡Šï¼ŒåˆåŠ äº† 8 å¡Šï¼Œç¾åœ¨æœ‰å¤šå°‘å¡Šï¼Ÿ", answer: 14, options: [12, 14, 16, 13] },
                      { question: "æˆ´å¤«ä¸Ÿå‡º 15 é¡†è¾£æ¤’ï¼Œç‚¸æ‰äº† 7 é¡†ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 8, options: [7, 8, 9, 6] },
                      { question: "æ®­å±å·èµ°äº† 12 é¡†é™½å…‰ï¼Œæ¤ç‰©æ¶å›äº† 5 é¡†ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "è±Œè±†å°„æ‰‹ç™¼å°„äº† 9 é¡†è±Œè±†ï¼Œè¢«æ“‹ä¸‹äº† 3 é¡†ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 6, options: [5, 6, 7, 8] },
                      { question: "å‘æ—¥è‘µç”¢å‡º 7 é¡†é™½å…‰ï¼Œåˆç”¢å‡º 6 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 13, options: [12, 13, 14, 15] },
                      { question: "æ®­å±åŸæœ¬æœ‰ 14 éš»ï¼Œè¢«æ‰“å€’äº† 6 éš»ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] },
                      { question: "å¯’å†°å°„æ‰‹å‡ä½äº† 10 éš»æ®­å±ï¼Œåˆå‡ä½äº† 5 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 15, options: [14, 15, 16, 17] },
                      { question: "å …æœç‰†åŸæœ¬æœ‰ 11 å¡Šï¼Œè¢«æ’å£äº† 4 å¡Šï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "æˆ´å¤«ä¸Ÿå‡º 8 é¡†ç‰ç±³ï¼Œåˆä¸Ÿäº† 7 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 15, options: [14, 15, 16, 17] },
                      { question: "æ®­å±åšå£«æ´¾å‡º 20 éš»æ®­å±ï¼Œè¢«æ¤ç‰©æ‰“å€’äº† 9 éš»ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 11, options: [10, 11, 12, 13] },
                      { question: "å—ç“œé ­ä¿è­·äº† 6 æ£µæ¤ç‰©ï¼Œåˆä¿è­·äº† 5 æ£µï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 11, options: [10, 11, 12, 13] },
                      { question: "ç£éµè‡å¸èµ°äº† 13 å€‹éµæ¡¶ï¼Œåˆå¸èµ°äº† 4 å€‹ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 17, options: [16, 17, 18, 19] },
                      { question: "çˆ†ç‚¸æ«»æ¡ƒç‚¸æ‰äº† 9 éš»æ®­å±ï¼Œåˆç‚¸æ‰äº† 6 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 15, options: [14, 15, 16, 17] },
                      { question: "é¦™è’²å°„å‡º 12 æ ¹ç®­ï¼Œè¢«æ“‹ä¸‹äº† 5 æ ¹ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "åœ°é›·ç‚¸æ‰äº† 10 éš»æ®­å±ï¼Œåˆç‚¸æ‰äº† 8 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 18, options: [17, 18, 19, 20] },
                      { question: "å†°å‡è˜‘è‡å‡ä½äº† 16 éš»æ®­å±ï¼Œè§£å‡äº† 7 éš»ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] },
                      { question: "é›™å‘å°„æ‰‹å°„å‡º 5 é¡†è±Œè±†ï¼Œåˆå°„å‡º 6 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 11, options: [10, 11, 12, 13] },
                      { question: "å¤§è’œè½‰ç§»äº† 14 éš»æ®­å±ï¼Œåˆè½‰ç§»äº† 6 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 20, options: [18, 20, 22, 24] },
                      { question: "èˆç‹æ®­å±å¬å–šäº† 9 æ¬¡èˆä¼´ï¼Œæ¯æ¬¡ 1 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] },
                      { question: "å·¨äººæ®­å±æ‰“å€’äº† 12 æ£µæ¤ç‰©ï¼Œè¢«åæ“Šæ‰“å€’äº† 5 éš»æ®­å±ï¼Œé‚„å‰©å¤šå°‘æ¤ç‰©è¢«æ‰“å€’ï¼Ÿ", answer: 7, options: [6, 7, 8, 9] },
                      { question: "æˆ´å¤«ä¸Ÿå‡º 10 é¡†è¾£æ¤’ï¼Œç‡’æ‰äº† 4 é¡†ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 6, options: [5, 6, 7, 8] },
                      { question: "é™½å…‰è‡ç”¢å‡º 6 é¡†é™½å…‰ï¼Œåˆç”¢å‡º 7 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 13, options: [12, 13, 14, 15] },
                      { question: "çˆ†ç±³èŠ±æ©Ÿçˆ†å‡º 11 é¡†çˆ†ç±³èŠ±ï¼Œè¢«åƒæ‰äº† 3 é¡†ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] },
                      { question: "å†°è¥¿ç“œæŠ•æ‰‹ä¸Ÿå‡º 9 é¡†å†°è¥¿ç“œï¼Œåˆä¸Ÿäº† 6 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 15, options: [14, 15, 16, 17] },
                      { question: "åœ°åˆºç‹åˆºç©¿äº† 10 éš»æ®­å±ï¼Œè¢«ç§»é™¤ 2 æ¬¡ï¼Œé‚„å‰©å¤šå°‘æ¬¡åˆºç©¿ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] },
                      { question: "é«˜å …æœç‰†å‡ç´šäº† 7 æ¬¡ï¼Œåˆå‡ç´šäº† 5 æ¬¡ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 12, options: [11, 12, 13, 14] },
                      { question: "å‘æ—¥è‘µç”¢å‡º 9 é¡†é™½å…‰, åˆç”¢å‡º 4 é¡†é™½å…‰ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 13, options: [12, 13, 14, 15] },
                      { question: "æ®­å±åšå£«æ´¾å‡º 18 éš»æ®­å±ï¼Œè¢«æ¤ç‰©æ‰“å€’äº† 9 éš»ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] }                     
                    ],
                    mixed: [
                      { question: "å¯’å†°å°„æ‰‹ä¸€æ¬¡å°„å‡º 5 é¡†å†°çƒï¼Œæ¯é¡†æ‰“ä¸­ 4 éš»æ®­å±ï¼Œä¸€å…±æ‰“ä¸­å¤šå°‘éš»ï¼Ÿ", answer: 20, options: [16, 20, 24, 18] },
                      { question: "æ®­å±åŸæœ¬æœ‰ 13 éš»ï¼Œè¢«æ¤ç‰©æ‰“å€’äº† 8 éš»ï¼Œé‚„å‰©å¤šå°‘éš»ï¼Ÿ", answer: 5, options: [4, 5, 6, 7] },
                      { question: "æ¤ç‰©è£œçµ¦äº† 7 é¡†èƒ½é‡è±†ï¼Œåˆè£œäº† 6 é¡†ï¼Œä¸€å…±è£œäº†å¤šå°‘ï¼Ÿ", answer: 13, options: [12, 13, 14, 11] },
                      { question: "3 Ã— 9 çš„æ®­å±è¢«ç‚¸æ‰äº†ï¼Œç¸½å…±å¤šå°‘éš»ï¼Ÿ", answer: 27, options: [24, 27, 30, 21] },
                      { question: "å·¨äººæ®­å±åŸæœ¬æœ‰ 16 éš»ï¼Œè¢«æ‰“å€’äº† 9 éš»ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 7, options: [6, 7, 8, 5] },
                      { question: "æˆ´å¤«ä¸Ÿå‡º 8 é¡†è¾£æ¤’ï¼Œæ¯é¡†ç‡’æ‰ 5 éš»æ®­å±ï¼Œä¸€å…±ç‡’æ‰å¤šå°‘ï¼Ÿ", answer: 40, options: [35, 40, 45, 50] },
                      { question: "å‘æ—¥è‘µç”¢å‡º 4 é¡†é™½å…‰ï¼Œé€£çºŒ 6 å¤©ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 24, options: [20, 24, 28, 30] },
                      { question: "æ®­å±åšå£«æ´¾å‡º 20 éš»æ®­å±ï¼Œè¢«æ¤ç‰©æ‰“å€’äº† 12 éš»ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] },
                      { question: "å …æœç‰†æœ‰ 5 å±¤ï¼Œæ¯å±¤ 6 å¡Šï¼Œè¢«æ’å£äº† 10 å¡Šï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 20, options: [18, 20, 22, 24] },
                      { question: "çˆ†ç‚¸æ«»æ¡ƒç‚¸æ‰ 3 çµ„æ®­å±ï¼Œæ¯çµ„ 7 éš»ï¼Œä¸€å…±ç‚¸æ‰å¤šå°‘ï¼Ÿ", answer: 21, options: [18, 21, 24, 27] },
                      { question: "é¦™è’²å°„å‡º 6 æ ¹ç®­ï¼Œè¢«æ“‹ä¸‹äº† 2 æ ¹ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 4, options: [3, 4, 5, 6] },
                      { question: "åœ°é›·ç‚¸æ‰ 4 çµ„æ®­å±ï¼Œæ¯çµ„ 5 éš»ï¼Œåˆç‚¸æ‰äº† 6 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 26, options: [24, 25, 26, 28] },
                      { question: "å†°å‡è˜‘è‡å‡ä½ 3 æ’æ®­å±ï¼Œæ¯æ’ 8 éš»ï¼Œè§£å‡äº† 4 éš»ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 20, options: [18, 20, 22, 24] },
                      { question: "é›™å‘å°„æ‰‹å°„å‡º 2 é¡†è±Œè±†ï¼Œå°„äº† 10 æ¬¡ï¼ŒåˆåŠ å°„ 4 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 24, options: [22, 24, 26, 28] },
                      { question: "èˆç‹æ®­å±å¬å–šäº† 5 æ¬¡èˆä¼´ï¼Œæ¯æ¬¡ 3 éš»ï¼Œåˆå¬å–šäº† 2 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 17, options: [15, 16, 17, 18] },
                      { question: "ç£éµè‡å¸èµ° 6 å€‹éµæ¡¶ï¼Œæ¯å€‹å€¼ 10 åˆ†ï¼Œåˆå¸èµ° 2 å€‹ï¼Œä¸€å…±å¾—å¤šå°‘åˆ†ï¼Ÿ", answer: 80, options: [70, 80, 90, 100] },
                      { question: "å—ç“œé ­ä¿è­·äº† 4 æ£µæ¤ç‰©ï¼Œæ¯æ£µä¿è­· 5 æ¬¡ï¼ŒåˆåŠ å¼· 4 æ¬¡ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 24, options: [22, 24, 26, 28] },
                      { question: "æ®­å±å·èµ°äº† 9 é¡†é™½å…‰ï¼Œåˆå·èµ°äº† 6 é¡†ï¼Œè¢«æ¶å› 5 é¡†ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", answer: 10, options: [9, 10, 11, 12] },
                      { question: "çˆ†ç±³èŠ±æ©Ÿçˆ†å‡º 7 é¡†çˆ†ç±³èŠ±ï¼Œæ¯é¡†æ‰“ä¸­ 2 éš»æ®­å±ï¼Œä¸€å…±æ‰“ä¸­å¤šå°‘ï¼Ÿ", answer: 14, options: [12, 14, 16, 18] },
                      { question: "å†°è¥¿ç“œæŠ•æ‰‹ä¸Ÿå‡º 3 é¡†å†°è¥¿ç“œï¼Œæ¯é¡†æ‰“ä¸­ 6 éš»æ®­å±ï¼Œåˆæ‰“ä¸­ 4 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 22, options: [20, 22, 24, 26] },
                      { question: "åœ°åˆºç‹åˆºç©¿ 5 éš»æ®­å±ï¼Œæ¯éš»åˆº 2 æ¬¡ï¼Œåˆåˆºäº† 3 æ¬¡ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 13, options: [12, 13, 14, 15] },
                      { question: "é«˜å …æœç‰†å‡ç´šäº† 6 æ¬¡ï¼Œæ¯æ¬¡å¢åŠ  3 å¡Šï¼ŒåˆåŠ äº† 6 å¡Šï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 24, options: [22, 24, 26, 28] },
                      { question: "å‘æ—¥è‘µåœ¨ 7 å¤©å…§æ¯å¤©ç”¢å‡º 5 é¡†é™½å…‰ï¼Œåˆå¤šç”¢ 3 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 38, options: [36, 38, 40, 42] },
                      { question: "æ®­å±åšå£«æ´¾å‡º 4 å°æ©Ÿå™¨ï¼Œæ¯å°æœ‰ 6 éš»æ®­å±ï¼ŒåˆåŠ æ´¾ 5 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 29, options: [28, 29, 30, 31] },
                      { question: "å …æœç‰†æœ‰ 10 å¡Šï¼Œè¢«æ’å£äº† 3 å¡Šï¼Œåˆä¿®å¾©äº† 2 å¡Šï¼Œç¾åœ¨æœ‰å¤šå°‘ï¼Ÿ", answer: 9, options: [8, 9, 10, 11] },
                      { question: "çˆ†ç‚¸æ«»æ¡ƒç‚¸æ‰ 2 çµ„æ®­å±ï¼Œæ¯çµ„ 6 éš»ï¼Œåˆç‚¸æ‰ 5 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 17, options: [16, 17, 18, 19] },
                      { question: "é¦™è’²å°„å‡º 4 æ ¹ç®­ï¼Œæ¯æ ¹æ‰“ä¸­ 3 éš»æ®­å±ï¼Œåˆæ‰“ä¸­ 2 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 14, options: [12, 14, 16, 18] },
                      { question: "åœ°é›·ç‚¸æ‰ 5 éš»æ®­å±ï¼Œåˆç‚¸æ‰ 4 éš»ï¼Œæ¯éš»å€¼ 2 åˆ†ï¼Œä¸€å…±å¾—å¤šå°‘åˆ†ï¼Ÿ", answer: 18, options: [16, 18, 20, 22] },
                      { question: "å†°å‡è˜‘è‡å‡ä½ 6 æ’æ®­å±ï¼Œæ¯æ’ 5 éš»ï¼Œåˆå‡ä½ 4 éš»ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 34, options: [32, 34, 36, 38] },
                      { question: "é›™å‘å°„æ‰‹å°„å‡º 3 é¡†è±Œè±†ï¼Œå°„äº† 6 æ¬¡ï¼ŒåˆåŠ å°„ 3 é¡†ï¼Œä¸€å…±å¤šå°‘ï¼Ÿ", answer: 21, options: [20, 21, 22, 24] },
                      { question: "èˆç‹æ®­å±å¬å–š 20 éš»èˆä¼´ï¼Œæ¯æ¬¡å¬å–š 4 éš»ï¼Œä¸€å…±å¬å–šå¹¾æ¬¡ï¼Ÿ", answer: 5, options: [4, 5, 6, 7] },
                      { question: "å·¨äººæ®­å±æ‰“å€’ 18 æ£µæ¤ç‰©ï¼Œæ¯æ¬¡æ‰“å€’ 6 æ£µï¼Œä¸€å…±æ‰“äº†å¹¾æ¬¡ï¼Ÿ", answer: 3, options: [2, 3, 4, 5] },
                      { question: "æˆ´å¤«ä¸Ÿå‡º 30 é¡†è¾£æ¤’ï¼Œæ¯æ¬¡ä¸Ÿ 5 é¡†ï¼Œä¸€å…±ä¸Ÿäº†å¹¾æ¬¡ï¼Ÿ", answer: 6, options: [5, 6, 7, 8] },
                      { question: "é™½å…‰è‡ç”¢å‡º 32 é¡†é™½å…‰ï¼Œæ¯æ¬¡ç”¢å‡º 4 é¡†ï¼Œä¸€å…±ç”¢å‡ºå¹¾æ¬¡ï¼Ÿ", answer: 8, options: [7, 8, 9, 10] } 
                    ]
                };
            }

            bindModeSelection() {
                document.getElementById('multiplicationMode').addEventListener('click', () => this.selectMode('multiplication'));
                document.getElementById('addSubMode').addEventListener('click', () => this.selectMode('addSub'));
                document.getElementById('mixedMode').addEventListener('click', () => this.selectMode('mixed'));
                document.getElementById('divisionMode').addEventListener('click', () => this.selectMode('division'));
                
                document.getElementById('easyDifficulty').addEventListener('click', () => this.startGame('easy'));
                document.getElementById('normalDifficulty').addEventListener('click', () => this.startGame('normal'));
                document.getElementById('hardDifficulty').addEventListener('click', () => this.startGame('hard'));
                document.getElementById('backToModeBtn').addEventListener('click', () => this.backToModeSelection());
            }

            selectMode(mode) {
                this.gameMode = mode;
                
                // æ›´æ–°é¸æ“‡çš„æ¨¡å¼æ–‡å­—
                const modeNames = {
                    'multiplication': 'ä¹ä¹ä¹˜æ³•è¡¨',
                    'division': 'ç™¾å…§æ•¸é™¤æ³•',                   
                    'addSub': 'å–®ä½æ•¸åŠ æ¸›',
                    'mixed': 'æ··åˆæ¨¡å¼'
                };
                document.getElementById('selectedModeText').textContent = `å·²é¸æ“‡ï¼š${modeNames[mode]}`;
                
                // é¡¯ç¤ºé›£åº¦é¸æ“‡ï¼Œéš±è—æ¨¡å¼é¸æ“‡
                document.getElementById('modeSelection').classList.add('hidden');
                document.getElementById('difficultySelection').classList.remove('hidden');
            }

            backToModeSelection() {
                document.getElementById('difficultySelection').classList.add('hidden');
                document.getElementById('modeSelection').classList.remove('hidden');
                this.gameMode = null;
            }

            startGame(difficulty) {
                this.difficulty = difficulty;
                
                // éš¨æ©Ÿé¸æ“‡æ¤ç‰©è§’è‰²
                this.selectRandomPlant();
                
                // æ›´æ–°æ¨™é¡Œ
                const subtitle = document.getElementById('gameSubtitle');
                const questionTitle = document.getElementById('questionTitle');
                const difficultyText = { easy: 'ç°¡å–®', normal: 'æ™®é€š', hard: 'å›°é›£' }[difficulty];
                
                switch(this.gameMode) {
                    case 'multiplication':
                        subtitle.textContent = `ä¹ä¹ä¹˜æ³•è¡¨å¤§ä½œæˆ° (${difficultyText})`;
                        questionTitle.textContent = 'âœ–ï¸ ä¹˜æ³•æŒ‘æˆ°';
                        break;
                    case 'addSub':
                        subtitle.textContent = `åŠ æ¸›æ³•å¤§ä½œæˆ° (${difficultyText})`;
                        questionTitle.textContent = 'â•â– åŠ æ¸›æ³•æŒ‘æˆ°';
                        break;
                    case 'mixed':
                        subtitle.textContent = `æ··åˆæ¨¡å¼å¤§ä½œæˆ° (${difficultyText})`;
                        questionTitle.textContent = 'ğŸ¯ æ··åˆæŒ‘æˆ°';
                        break;
                }
                
                // éš±è—é›£åº¦é¸æ“‡ï¼Œé¡¯ç¤ºéŠæˆ²
                document.getElementById('difficultySelection').classList.add('hidden');
                document.getElementById('gameArea').classList.remove('hidden');
                
                this.initializeGame();
                this.bindEvents();
                
                // æª¢æŸ¥æ˜¯å¦è§¸ç™¼æ‹¯æ•‘é—œå¡ (15% æ©Ÿç‡)
                if (Math.random() < 0.18) {
                    this.triggerRescueLevel();
                }
            }


            selectRandomPlant() {
                const plantNames = Object.keys(this.plants);
                const randomPlant = plantNames[Math.floor(Math.random() * plantNames.length)];
                this.currentPlant = this.plants[randomPlant];
                this.currentPlantName = randomPlant;
                
                // æ›´æ–°æ¤ç‰©è§’è‰²é¡¯ç¤º
                document.getElementById('plantChar').textContent = this.currentPlant.emoji;
                document.getElementById('plantName').textContent = `${randomPlant} (${this.currentPlant.skill})`;
            }
                                  
            triggerRescueLevel() {
                this.isRescueLevel = true;
                this.balloonZombieHealth = 150;
                this.level--;
                
                // éš±è—éŠæˆ²å€åŸŸï¼Œé¡¯ç¤ºæ‹¯æ•‘ç•«é¢
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('rescueScreen').classList.remove('hidden');

                // 3ç§’å¾Œé–‹å§‹æ‹¯æ•‘é—œå¡
                setTimeout(() => {
                    document.getElementById('rescueScreen').classList.add('hidden');
                    document.getElementById('gameArea').classList.remove('hidden');
                    
                    // è¨­ç½®æ‹¯æ•‘é—œå¡çš„ç‰¹æ®ŠèƒŒæ™¯
                    document.getElementById('gameArea').className = 'rescue-bg rounded-xl p-8 shadow-2xl rescueGlow';
                    
                    this.initializeRescueGame();
                }, 3000);
            }

            initializeRescueGame() {
                // å‰µå»ºæ±½çƒæ®­å±
                this.zombieArmy = [{
                    id: 0,
                    type: this.balloonZombie.emoji,
                    name: this.balloonZombie.name,
                    health: this.balloonZombieHealth,
                    maxHealth: this.balloonZombieHealth,
                    alive: true,
                    isBoss: true,
                    isBalloon: true,
                    skillCooldown: 0
                }];
                
                this.renderZombieArmy();
                this.updateDisplay();
                this.generateQuestion();
                this.startTimer();
                this.gameActive = true;
            }

            initializeGame() {
                this.createZombieArmy();
                this.updateDisplay();
                this.generateQuestion();
                this.startTimer();
                this.gameActive = true;
            }

            createZombieArmy() {
                this.zombieArmy = [];
                const settings = this.difficultySettings[this.difficulty];
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºBossé—œå¡
                if (this.isBossLevel()) {
                    const boss = this.bossTypes[this.level];
                    const bossHealth = Math.floor(boss.health * settings.bossHealthMultiplier);
                    this.zombieArmy.push({
                        id: 0,
                        type: boss.emoji,
                        name: boss.name,
                        health: bossHealth,
                        maxHealth: bossHealth,
                        alive: true,
                        isBoss: true,
                        skillCooldown: 0
                    });
                } else {
                    // æ™®é€šé—œå¡ï¼šæ ¹æ“šé—œå¡æ±ºå®šæ®­å±æ•¸é‡ (3-6éš»)
                    const zombieCount = Math.min(3 + this.level - 1, 6);

                    for (let i = 0; i < zombieCount; i++) {
                        const zType = this.zombieTypes[Math.floor(Math.random() * this.zombieTypes.length)];
                        this.zombieArmy.push({
                            id: i,
                            type: zType,
                            health: settings.zombieHealth,
                            maxHealth: settings.zombieHealth,
                            alive: true,
                            isBoss: false,
                            skillCooldown: 0
                        });
                    }
                }
                
                this.renderZombieArmy();
                this.startZombieSkills();
            }

            isBossLevel() {
                return [3, 5, 7, 9, 10, 13, 15].includes(this.level);
            }

            renderZombieArmy() {
                const armyContainer = document.getElementById('zombieArmy');
                armyContainer.innerHTML = '';
                
                this.zombieArmy.forEach(zombie => {
                    if (zombie.alive) {
                        const zombieEl = document.createElement('div');
                        
                        if (zombie.isBoss) {
                            const bossClass = zombie.isBalloon ? 'zombie-unit text-6xl transition-all duration-300 float rescueGlow pulse' : 'zombie-unit text-6xl transition-all duration-300 bossGlow pulse';
                            zombieEl.className = bossClass;
                            const healthBarColor = zombie.isBalloon ? 'bg-yellow-500' : 'bg-red-500';
                            zombieEl.innerHTML = `
                                <div class="text-center">
                                    <div class="text-6xl mb-1">${zombie.type}</div>
                                    <div class="text-sm ${zombie.isBalloon ? 'text-yellow-300' : 'text-red-300'} font-bold">${zombie.name}</div>
                                    <div class="w-20 h-2 bg-gray-700 rounded-full mx-auto mt-1">
                                        <div class="h-full ${healthBarColor} rounded-full transition-all" style="width: ${(zombie.health / zombie.maxHealth) * 100}%"></div>
                                    </div>
                                </div>
                            `;
                        } else {
                            zombieEl.className = 'zombie-unit text-4xl transition-all duration-300';
                            zombieEl.innerHTML = `
                                <div class="text-center">
                                    <div class="text-4xl mb-1">${zombie.type}</div>
                                    <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto">
                                        <div class="h-full bg-red-500 rounded-full transition-all" style="width: ${(zombie.health / zombie.maxHealth) * 100}%"></div>
                                    </div>
                                </div>
                            `;
                            
                            // æ ¹æ“šè¡€é‡èª¿æ•´é€æ˜åº¦
                            const opacity = zombie.health / zombie.maxHealth;
                            zombieEl.style.opacity = Math.max(0.3, opacity);
                        }
                        
                        zombieEl.dataset.zombieId = zombie.id;
                        armyContainer.appendChild(zombieEl);
                    }
                });
            }

            bindEvents() {
                document.getElementById('ultimateBtn').addEventListener('click', () => this.useUltimateSkill());
                document.getElementById('healBtn').addEventListener('click', () => this.useHealSkill());
                document.getElementById('restartBtn').addEventListener('click', () => this.restartGame());
                document.getElementById('playAgainBtn').addEventListener('click', () => this.restartGame());
            }

            startZombieSkills() {
                if (this.zombieSkillTimer) {
                    clearInterval(this.zombieSkillTimer);
                }
                
                const settings = this.difficultySettings[this.difficulty];
                const actualSkillChance = this.isSecretLevel ? Math.max(settings.skillChance, 0.6) : settings.skillChance;
                
                // ğŸ”¥ Boss é—œæŠ€èƒ½æ›´å¯†é›†ï¼ˆæ¯é—œæ¸›å°‘ 50msï¼Œæœ€ä½ 400msï¼‰
                const interval = this.isBossLevel() ? Math.max(1000 - this.level * 80, 500) : 1000;
                
                if (actualSkillChance > 0) {
                    this.zombieSkillTimer = setInterval(() => {
                        if (this.gameActive) {
                            // å†·å»éæ¸›ï¼šæ¯ç§’éæ¸›ç›´åˆ°0
                            this.zombieArmy.forEach(z => { if (z.skillCooldown > 0) z.skillCooldown = Math.max(0, z.skillCooldown - 1); });
                            if (Math.random() < actualSkillChance) {
                                this.activateZombieSkill();
                            }
                        }
                    }, interval); // æ¯ç§’æª¢æŸ¥ä¸¦éæ¸›å†·å»
                }
            }

            activateZombieSkill() {
                const aliveZombies = this.zombieArmy.filter(z => z.alive && z.skillCooldown <= 0);
                if (aliveZombies.length === 0) return;
                
                const zombie = aliveZombies[Math.floor(Math.random() * aliveZombies.length)];
                zombie.skillCooldown = 6; // 6ç§’å†·å»
                                
                //let skills = ['coverTop','desaturate','shake','distort','englishify', 'shuffle', 'timeReduce', 'hide', 'freeze', 'blind', 'confuse', 'multiply', 'disguise'];
                const allSkills = [
                  'hide','shake','distort','blind','confuse','multiply',
                  'shuffle','freeze','englishify',
                  'disguise','coverTop','desaturate','timeReduce'
                ];

                // æ¯é—œè§£é–æŠ€èƒ½æ•¸ = Math.floor((level / 5) * allSkills.length)
                const unlockedSkillCount = Math.min(
                  Math.floor((this.level / 5) * allSkills.length),
                  allSkills.length
                );

                const availableSkills = allSkills.slice(0, unlockedSkillCount);

                
                
                // ğŸ§Ÿâ€â™‚ï¸ Boss ç™¼å‹•å¤šå€‹æŠ€èƒ½
                const skillCount = zombie.isBoss ? Math.floor(Math.random() * 2) + 1 : 1; // Bossç™¼å‹•1~2å€‹æŠ€èƒ½ï¼Œæ™®é€šæ®­å±åªç™¼å‹•1å€‹

                for (let i = 0; i < skillCount; i++) {
                    const skill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                    this.executeZombieSkill(skill, zombie);
                }
                
                // æ¸›å°‘å†·å»æ™‚é–“
                setTimeout(() => {
                    if (zombie.skillCooldown > 0) zombie.skillCooldown--;
                }, 1000);
            }

            executeZombieSkill(skill, zombie) {
                const messageEl = document.getElementById('gameMessage');
                
                switch(skill) {
                    case 'hide':
                        this.hideRandomOption();
                        messageEl.textContent = `ğŸ‘» ${zombie.type} ä½¿ç”¨éš±èº«è¡“ï¼ä¸€å€‹é¸é …è¢«éš±è—äº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-purple-600';
                        break;
                        
                    case 'shuffle':
                        this.shuffleOptions();
                        messageEl.textContent = `ğŸŒªï¸ ${zombie.type} ä½¿ç”¨æ··äº‚è¡“ï¼é¸é …è¢«æ‰“äº‚äº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-orange-600';
                        break;
                        
                    case 'timeReduce':
                        this.timeLeft = Math.max(1, this.timeLeft - 1);
                        messageEl.textContent = `â° ${zombie.type} ä½¿ç”¨æ™‚é–“è©›å’’ï¼æ™‚é–“æ¸›å°‘1ç§’ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-red-600';
                        break;
                        
                    case 'disguise':
                        this.disguiseOptions();
                        messageEl.textContent = `ğŸ­ ${zombie.type} ä½¿ç”¨å½è£è¡“ï¼é¸é …å¤–è§€æ”¹è®Šäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-blue-600';
                        break;
                        
                    case 'freeze':
                        this.freezeOptions();
                        messageEl.textContent = `â„ï¸ ${zombie.type} ä½¿ç”¨å†°å‡è¡“ï¼é¸é …è¢«å‡çµäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-cyan-600';
                        break;
                        
                    case 'blind':
                        this.blindOptions();
                        messageEl.textContent = `ğŸŒ«ï¸ ${zombie.type} ä½¿ç”¨è‡´ç›²è¡“ï¼é¸é …è®Šæ¨¡ç³Šäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-gray-600';
                        break;
                        
                    case 'confuse':
                        this.confuseOptions();
                        messageEl.textContent = `ğŸŒ€ ${zombie.type} ä½¿ç”¨æ··æ·†è¡“ï¼é¸é …åœ¨æ—‹è½‰ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-indigo-600';
                        break;
                        
                    case 'multiply':
                        this.multiplyOptions();
                        messageEl.textContent = `ğŸª ${zombie.type} ä½¿ç”¨åˆ†èº«è¡“ï¼å‡ºç¾å‡é¸é …äº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-pink-600';
                        break;
                    case 'englishify':
                        this.englishifyOptions();
                        messageEl.textContent = `ğŸ‡¬ğŸ‡§ ${zombie.type} ä½¿ç”¨è‹±æ–‡è©›å’’ï¼è«‹ç”¨è‹±æ–‡ä½œç­”ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-blue-700';
                        break;
                    case 'distort':
                        this.distortOptions();
                        messageEl.textContent = `ğŸ” ${zombie.type} ä½¿ç”¨ç¸®æ”¾å¹²æ“¾ï¼é¸é …å¤§å°æ··äº‚å•¦ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-yellow-600';
                        break;                        
                    case 'shake':
                        this.shakeOptions();
                        messageEl.textContent = `ğŸ©¸ ${zombie.type} ä½¿ç”¨éœ‡å‹•è¡“ï¼é¸é …é–‹å§‹æŠ–å‹•å•¦ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-red-600';
                        break;          
                    case 'desaturate':
                        this.desaturateOptions();
                        messageEl.textContent = `ğŸ§« ${zombie.type} ä½¿ç”¨é¡è‰²å¹²æ“¾è¡“ï¼é¸é …è®Šæˆé»‘ç™½ç°å•¦ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-gray-600';
                        break;    
                    case 'coverTop':
                        this.coverTopHalfOfText();
                        messageEl.textContent = `ğŸ•³ï¸ ${zombie.type} ä½¿ç”¨ä¸ŠåŠé®è”½è¡“ï¼é¡Œç›®è¢«è“‹ä½ä¸€åŠäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-gray-700';
                        break;
                        
                }

                
                // æ®­å±æŠ€èƒ½å‹•ç•«
                const zombieEl = document.querySelector(`[data-zombie-id="${zombie.id}"]`);
                if (zombieEl) {
                    zombieEl.classList.add('pulse');
                    setTimeout(() => zombieEl.classList.remove('pulse'), 1000);
                }
                
                this.updateDisplay();
                
                setTimeout(() => {
                    messageEl.textContent = '';
                }, 3000);
            }

            // å°‡æ•¸å­—è½‰ç‚ºè‹±æ–‡å–®å­— (0-999 ç°¡æ˜“ç‰ˆï¼ŒéŠæˆ²å¯¦éš› â‰¤ 100)
            numberToEnglish(n) {
                const ones = ['zero','one','two','three','four','five','six','seven','eight','nine'];
                const teens = ['ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'];
                const tens = ['','','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'];
                if (n < 10) return ones[n];
                if (n < 20) return teens[n - 10];
                if (n < 100) {
                    const t = Math.floor(n / 10);
                    const r = n % 10;
                    return r === 0 ? tens[t] : `${tens[t]} ${ones[r]}`;
                }
                if (n < 1000) {
                    const h = Math.floor(n / 100);
                    const r = n % 100;
                    const rest = r === 0 ? '' : ` ${this.numberToEnglish(r)}`;
                    return `${ones[h]} hundred${rest}`;
                }
                return String(n);
            }

            // æ®­å±æŠ€èƒ½ï¼šå°‡é¡Œç›®é¸é …æ”¹ç‚ºè‹±æ–‡å–®å­—é¡¯ç¤ºï¼Œä¸¦ä»¥è‹±æ–‡ä½œç­”
            englishifyOptions() {
                if (this.englishModeActive) return;
                const optionsArea = document.getElementById('optionsArea');
                if (!optionsArea || optionsArea.children.length === 0) return;

                // å‚™ä»½ç•¶å‰é¸é …èˆ‡ç­”æ¡ˆ
                const currentButtons = Array.from(optionsArea.children);
                const numericOptions = currentButtons.map(btn => {
                    const val = btn.dataset.answer;
                    return isNaN(val) ? val : parseInt(val);
                });
                this.originalOptionsBackup = numericOptions;
                this.currentAnswerBackup = this.currentAnswer;

                // åƒ…åœ¨æ•¸å­¸æˆ–æ–‡å­—æ•¸å­—é¡Œç”Ÿæ•ˆï¼ˆæ’é™¤å·²æ˜¯æ–‡å­—ç­”æ¡ˆçš„é¡Œå‹ï¼‰
                const allNumbers = numericOptions.every(v => typeof v === 'number');
                if (!allNumbers) return;

                // åˆ‡æ›ç‚ºè‹±æ–‡æ¨¡å¼
                this.englishModeActive = true;
                const englishOptions = numericOptions.map(n => this.numberToEnglish(n));
                const englishAnswer = this.numberToEnglish(this.currentAnswer);

                // é‡æ–°æ¸²æŸ“è‹±æ–‡é¸é …
                this.currentAnswer = englishAnswer;
                this.renderOptions(englishOptions);

                // é¡¯ç¤ºè‹±æ–‡ä½œç­”æç¤º
                const hintEl = document.getElementById('questionHint');
                hintEl.textContent = 'è«‹é¸æ“‡æ­£ç¢ºçš„è‹±æ–‡æ•¸å­—å–®å­—ï¼';
            }

            hideRandomOption() {
                const options = document.querySelectorAll('.option-btn:not(.hidden)');
                if (options.length <= 2) return; // è‡³å°‘ä¿ç•™2å€‹é¸é …
                
                const correctOption = document.querySelector(`[data-answer="${this.currentAnswer}"]`);
                const availableOptions = Array.from(options).filter(opt => opt !== correctOption);
                
                if (availableOptions.length > 0) {
                    const randomOption = availableOptions[Math.floor(Math.random() * availableOptions.length)];
                    randomOption.classList.add('hidden');
                    this.hiddenOptions.push(randomOption);
                    
                    // 5ç§’å¾Œæ¢å¾©
                    setTimeout(() => {
                        randomOption.classList.remove('hidden');
                        this.hiddenOptions = this.hiddenOptions.filter(opt => opt !== randomOption);
                    }, 5000);
                }
            }

            shuffleOptions() {
                const optionsArea = document.getElementById('optionsArea');
                const options = Array.from(optionsArea.children);
                
                // æ‰“äº‚é †åº
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    optionsArea.insertBefore(options[j], options[i]);
                }
            }

            disguiseOptions() {
                const options = document.querySelectorAll('.option-btn');
                const disguiseEmojis = ['ğŸª', 'ğŸ¨', 'ğŸ­', 'ğŸ¯', 'ğŸ²', 'ğŸ®', 'ğŸ¸', 'ğŸº'];
                
                options.forEach(option => {
                    const originalEmoji = option.querySelector('span').previousSibling.textContent;
                    const disguiseEmoji = disguiseEmojis[Math.floor(Math.random() * disguiseEmojis.length)];
                    option.querySelector('span').previousSibling.textContent = disguiseEmoji;
                    
                    // 3ç§’å¾Œæ¢å¾©
                    setTimeout(() => {
                        const emojis = ['ğŸ¯', 'ğŸŒŸ', 'ğŸ’', 'ğŸ”¥', 'â­', 'ğŸª', 'ğŸ¨', 'ğŸ­'];
                        const index = Array.from(options).indexOf(option);
                        option.querySelector('span').previousSibling.textContent = emojis[index % emojis.length];
                    }, 3000);
                   
                });
            }

            freezeOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.pointerEvents = 'none';
                    option.style.opacity = '0.5';
                    option.style.filter = 'blur(1px)';
                    option.classList.add('cursor-not-allowed');
                    
                    // 1.3ç§’å¾Œè§£å‡
                    setTimeout(() => {
                        option.style.pointerEvents = 'auto';
                        option.style.opacity = '1';
                        option.style.filter = 'none';
                        option.classList.remove('cursor-not-allowed');
                    }, 1300);
                });
            }

            blindOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.filter = 'blur(3px)';
                    option.style.opacity = '0.7';
                    
                    // 4ç§’å¾Œæ¢å¾©è¦–åŠ›
                    setTimeout(() => {
                        option.style.filter = 'none';
                        option.style.opacity = '1';
                    }, 4000);
                });
            }

            confuseOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.transform = 'rotate(360deg)';
                    option.style.transition = 'transform 2s ease-in-out';
                    
                    // 5ç§’å¾Œåœæ­¢æ—‹è½‰
                    setTimeout(() => {
                        option.style.transform = 'rotate(0deg)';
                        setTimeout(() => {
                            option.style.transition = '';
                        }, 500);
                    }, 5000);
                });
            }

            multiplyOptions() {
                const optionsArea = document.getElementById('optionsArea');
                const existingOptions = Array.from(optionsArea.children);
                const fakeOptions = [];
                
                // å‰µå»º2å€‹å‡é¸é …
                for (let i = 0; i < 2; i++) {
                    const fakeOption = existingOptions[0].cloneNode(true);
                    const fakeAnswer = Math.floor(Math.random() * 100);
                    const answerSpan = fakeOption.querySelector('.text-xl:last-child');
                    if (answerSpan) {
                        answerSpan.textContent = fakeAnswer;
                    }
                    fakeOption.dataset.answer = fakeAnswer;
                    fakeOption.style.opacity = '0.8';
                    fakeOption.style.border = '2px dashed #666';

                    // å‡é¸é …é»æ“Šç„¡æ•ˆæœ
                    fakeOption.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const messageEl = document.getElementById('gameMessage');
                        messageEl.textContent = 'ğŸ‘» é€™æ˜¯å‡é¸é …ï¼';
                        messageEl.className = 'text-center text-lg font-bold h-8 text-gray-600';
                        setTimeout(() => messageEl.textContent = '', 1000);
                    });
                    
                    optionsArea.appendChild(fakeOption);
                    fakeOptions.push(fakeOption);
                }
                
                // 10ç§’å¾Œç§»é™¤å‡é¸é …
                setTimeout(() => {
                    fakeOptions.forEach(fake => {
                        if (fake.parentNode) {
                            fake.parentNode.removeChild(fake);
                        }
                    });
                }, 10000);
            }

            distortOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    // éš¨æ©Ÿç¸®æ”¾æ¯”ä¾‹ï¼ˆä¾‹å¦‚ 0.8 åˆ° 1.4 ä¹‹é–“ï¼‰
                    const scale = (Math.random() * 0.6 + 0.8).toFixed(2);
                    option.style.transform = `scale(${scale})`;
                    option.style.transition = 'transform 0.3s ease';

                    // 6 ç§’å¾Œæ¢å¾©åŸå§‹å¤§å°
                    setTimeout(() => {
                        option.style.transform = 'scale(1)';
                    }, 6000);
                });
            }  
            
            shakeOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.animation = 'shake 0.3s infinite';
                    
                    // 6 ç§’å¾Œåœæ­¢éœ‡å‹•
                    setTimeout(() => {
                        option.style.animation = 'none';
                    }, 6000);
                });
            }

            desaturateOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.filter = 'grayscale(100%)';
                    option.style.transition = 'filter 0.3s ease';

                    // 8 ç§’å¾Œæ¢å¾©åŸè‰²
                    setTimeout(() => {
                        option.style.filter = 'none';
                    }, 8000);
                });
            }       

            coverTopHalfOfText() {
                if (this.currentQuestionType === 'text') return;
                const questionEl = document.getElementById('question');
                // å»ºç«‹é®ç½©å±¤
                const overlay = document.createElement('div');
                overlay.className = 'top-half-cover';
                overlay.style.position = 'absolute';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.width = '100%';
                overlay.style.height = '45%'; // è“‹ä¸ŠåŠéƒ¨
                overlay.style.backgroundColor = 'rgba(229, 231, 235, 0.93)';
                overlay.style.pointerEvents = 'none';
                overlay.style.zIndex = '10';

                // ç¢ºä¿é¡Œç›®å®¹å™¨æœ‰å®šä½
                questionEl.style.position = 'relative';
                questionEl.appendChild(overlay);

                // 3.5 ç§’å¾Œç§»é™¤é®ç½©
                setTimeout(() => {
                    questionEl.removeChild(overlay);
                }, 3500);
            }
            
            forceTextQuestion() {
                // å¼·åˆ¶ä¸‹ä¸€é¡Œç‚ºæ–‡å­—é¡Œ
                setTimeout(() => {
                    if (this.gameActive) {
                        this.generateTextQuestion();
                    }
                }, 1000);
            }

            startQuestionTimer() {
                this.questionStartTime = Date.now();
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }
                
                // 10ç§’å¾Œå¦‚æœæ²’æœ‰é¸æ“‡ç­”æ¡ˆï¼Œå°±æ‰“äº‚é¸é …
                this.questionTimer = setTimeout(() => {
                    if (this.gameActive) {
                        this.shuffleOptions();
                        const messageEl = document.getElementById('gameMessage');
                        messageEl.textContent = 'â° æ™‚é–“å¤ªä¹…äº†ï¼é¸é …è¢«æ‰“äº‚äº†ï¼';
                        messageEl.className = 'text-center text-lg font-bold h-8 text-orange-600';
                        
                        setTimeout(() => {
                            messageEl.textContent = '';
                        }, 2000);
                    }
                }, 10000);
            }

            forceTextQuestion() {
                // å¼·åˆ¶ä¸‹ä¸€é¡Œç‚ºæ–‡å­—é¡Œ
                setTimeout(() => {
                    if (this.gameActive) {
                        this.generateTextQuestion();
                    }
                }, 1000);
            }

            generateQuestion() {
                // 20% æ©Ÿç‡å‡ºç¾æ–‡å­—é¡Œ (é—œå¡3ä»¥ä¸Š)
                const shouldUseTextQuestion = this.level >= 3 && Math.random() < 0.2;
 
                const hintEl = document.getElementById('questionHint');
                hintEl.textContent = this.originalHint;
 
                if (shouldUseTextQuestion) {
                    this.generateTextQuestion();
                } else {
                    this.generateMathQuestion();
                }
            }

            generateTextQuestion() {
                this.currentQuestionType = 'text';
                const modeQuestions = this.textQuestions[this.gameMode];
                const textQuestion = modeQuestions[Math.floor(Math.random() * modeQuestions.length)];
                
                this.currentAnswer = textQuestion.answer;
                document.getElementById('question').textContent = textQuestion.question;
                
                // ä½¿ç”¨é è¨­é¸é …ï¼Œä¸¦è£œè¶³åˆ°æœ¬é—œé¸é …æ•¸é‡
                this.optionCount = Math.min(4 + Math.floor((this.level - 1) / 2), 8);
                let options = [...textQuestion.options];
                const existing = new Set(options);
                while (options.length < this.optionCount) {
                    const delta = Math.floor(Math.random() * 9) + 1;
                    const candidate = Math.random() < 0.5 ? this.currentAnswer + delta : Math.max(0, this.currentAnswer - delta);
                    if (!existing.has(candidate) && candidate !== this.currentAnswer) {
                        options.push(candidate);
                        existing.add(candidate);
                    }
                }
                
                // éš¨æ©Ÿæ’åˆ—é¸é …
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                this.renderOptions(options);
                //console.log(textQuestion.question);
                //console.log(game.currentAnswer);
                //console.log(options);
                this.startQuestionTimer();
            }

            generateMathQuestion() {
                this.currentQuestionType = 'math';
                const num1 = Math.floor(Math.random() * 9) + 1;
                const num2 = Math.floor(Math.random() * 9) + 1;
                let questionText = '';
                let maxAnswer = 18;
                
                if (this.gameMode === 'multiplication') {
                    // ä¹ä¹ä¹˜æ³•è¡¨
                    this.currentAnswer = num1 * num2;
                    questionText = `${num1} Ã— ${num2} = ?`;
                    maxAnswer = 81;
                } else if (this.gameMode === 'addSub') {
                    // å–®ä½æ•¸åŠ æ¸›
                    const isAddition = Math.random() < 0.5;
                    if (isAddition) {
                        this.currentAnswer = num1 + num2;
                        questionText = `${num1} + ${num2} = ?`;
                    } else {
                        const larger = Math.max(num1, num2);
                        const smaller = Math.min(num1, num2);
                        this.currentAnswer = larger - smaller;
                        questionText = `${larger} - ${smaller} = ?`;
                    }
                } else if (this.gameMode === 'division') {
                    const divisor = Math.floor(Math.random() * 9) + 1; // 1~10
                    const quotient = Math.floor(Math.random() * 9) + 1; // 1~10
                    const dividend = divisor * quotient;
                    questionText = `${dividend} Ã· ${divisor} = ?`;
                    this.currentAnswer = quotient;
                    maxAnswer = 10;              
                } else if (this.gameMode === 'mixed') {
                    // æ··åˆæ¨¡å¼
                    const operation = Math.floor(Math.random() * 4);
                    if (operation === 0) {
                        // ä¹˜æ³•
                        this.currentAnswer = num1 * num2;
                        questionText = `${num1} Ã— ${num2} = ?`;
                        maxAnswer = 81;
                    } else if (operation === 1) {
                        // åŠ æ³•
                        this.currentAnswer = num1 + num2;
                        questionText = `${num1} + ${num2} = ?`;
                    } else if (operation === 2) {
                        // é™¤æ³•
                        const dividend = num1 * num2;
                        questionText = `${dividend} Ã· ${num1} = ?`;
                        this.currentAnswer = num2;
                        maxAnswer = 10;                            
                    } else {
                        // æ¸›æ³•
                        const larger = Math.max(num1, num2);
                        const smaller = Math.min(num1, num2);
                        this.currentAnswer = larger - smaller;
                        questionText = `${larger} - ${smaller} = ?`;
                    }
                }
                
                document.getElementById('question').textContent = questionText;
                
                // æ ¹æ“šé—œå¡å¢åŠ é¸é …æ•¸é‡ (4-8å€‹é¸é …)
                this.optionCount = Math.min(4 + Math.floor((this.level - 1) / 2), 8);
                
                // ç”Ÿæˆé¸é …
                const options = [this.currentAnswer];
                while (options.length < this.optionCount) {
                    const wrongAnswer = Math.floor(Math.random() * (maxAnswer + 1));
                    if (!options.includes(wrongAnswer)) {
                        options.push(wrongAnswer);
                    }
                }
                
                // éš¨æ©Ÿæ’åˆ—é¸é …
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                //console.log(questionText);
                //console.log(game.currentAnswer);

                this.renderOptions(options);
                this.startQuestionTimer();
            }

            renderOptions(options) {
                const optionsArea = document.getElementById('optionsArea');
                optionsArea.innerHTML = '';

                // æ ¹æ“šé¸é …æ•¸é‡èª¿æ•´ç¶²æ ¼
                let gridCols;
                if (this.optionCount <= 4) {
                    gridCols = 'grid-cols-2 md:grid-cols-2 lg:grid-cols-4';
                } else if (this.optionCount <= 6) {
                    gridCols = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-3';
                } else {
                    gridCols = 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4';
                }
                
                optionsArea.className = `grid ${gridCols} gap-3 md:gap-4 mb-6`;
                
                const emojis = ['ğŸ¯', 'ğŸŒŸ', 'ğŸ’', 'ğŸ”¥', 'â­', 'ğŸª', 'ğŸ¨', 'ğŸ­'];

                options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = `option-btn bg-gradient-to-r ${this.optionColors[index % this.optionColors.length]} text-white p-3 md:p-4 rounded-xl text-lg md:text-2xl font-bold transition-all shadow-lg transform hover:scale-105 hover:shadow-xl min-h-[80px] md:min-h-[100px] flex flex-col items-center justify-center`;
                    btn.innerHTML = `<div class="text-xl md:text-2xl mb-1">${emojis[index % emojis.length]}</div><div class="text-xl md:text-3xl">${option}</div>`;
                    btn.dataset.answer = option;
                    btn.addEventListener('click', (e) => {
                        const answer = e.currentTarget.dataset.answer;
                        // è™•ç†æ–‡å­—ç­”æ¡ˆå’Œæ•¸å­—ç­”æ¡ˆ
                        const parsedAnswer = isNaN(answer) ? answer : parseInt(answer);
                        this.selectAnswer(parsedAnswer);
                    });
                    optionsArea.appendChild(btn);
                });
            }

            selectAnswer(selectedAnswer) {
                if (!this.gameActive) return;
                                             
                                        
                
                // æ¸…é™¤å•é¡Œè¨ˆæ™‚å™¨
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }
                                           
                                               
                                  
                                              
                                      
                 
                
                // è™•ç†å­—ç¬¦ä¸²å’Œæ•¸å­—çš„æ¯”è¼ƒ
                const isCorrect = String(selectedAnswer) === String(this.currentAnswer);
                const messageEl = document.getElementById('gameMessage');
                
                if (isCorrect) {
                    this.englishModeActive = false;
                    this.originalOptionsBackup = null;
                    this.currentAnswerBackup = null;
                    
                    this.correctStreak++; // å¢åŠ é€£çºŒç­”å°æ¬¡æ•¸
                    
                    // åŸºç¤åˆ†æ•¸
                    let baseScore = 10 + (this.level * 5);
                    
                    // é€£çºŒç­”å°çå‹µ
                    let streakBonus = Math.floor(this.correctStreak / 3) * 10;
                    
                    // æœƒå¿ƒä¸€æ“Š (15% æ©Ÿç‡)
                    const isCritical = Math.random() < 0.15;
                    let criticalMultiplier = 1;
                    if (isCritical) {
                        criticalMultiplier = 2;
                    }
                    
                    const totalScore = (baseScore + streakBonus) * criticalMultiplier;
                    this.score += totalScore;
                    
                    this.timeLeft += 5; // æ”»æ“ŠæˆåŠŸåŠ 5ç§’æ™‚é–“
                    
                    // é€£çºŒç­”å°è£œè¡€ (æ¯3é¡Œç­”å°è£œè¡€)
                    if (this.correctStreak % 3 === 0) {
                        this.plantHealth = Math.min(100, this.plantHealth + 15);
                    }
                    
                    this.attackZombies(isCritical);
                    

                    
                    // é¡¯ç¤ºè¨Šæ¯
                    let message = 'ğŸ¯ æ­£ç¢ºï¼';
                    if (isCritical) {
                        message += ' ğŸ’¥ æœƒå¿ƒä¸€æ“Šï¼';
                    }
                    if (this.correctStreak % 3 === 0) {
                        message += ' ğŸ’– é€£çºŒç­”å°è£œè¡€ï¼';
                    }
                    message += ' â° +5ç§’';

                    messageEl.textContent = message;
                    messageEl.className = isCritical ?
                        'text-center text-lg font-bold h-8 text-yellow-600' :
                        'text-center text-lg font-bold h-8 text-green-600';

                    // æ¤ç‰©æ”»æ“Šå‹•ç•«
                    document.getElementById('plantChar').classList.add('bounce');
                    if (isCritical) {
                        document.getElementById('plantChar').classList.add('glow');
                    }
                    
                    // éš¨æ©Ÿæ›´æ›æ¤ç‰© - removed 
                    // document.getElementById('plantChar').textContent = this.plants[Math.floor(Math.random() * this.plants.length)];
                    this.triggerPlantSkill();
                } else {
                    this.correctStreak = 0; // é‡ç½®é€£çºŒç­”å°æ¬¡æ•¸
                    const damage = 10 + this.level * 2;
                    this.plantHealth = Math.max(0, this.plantHealth - damage); // é—œå¡è¶Šé«˜å‚·å®³è¶Šå¤§
                    

                    
                    messageEl.textContent = 'âŒ éŒ¯èª¤ï¼æ®­å±è»åœ˜åæ“Šäº†ï¼';
                    messageEl.className = 'text-center text-lg font-bold h-8 text-red-600';
                    
                    // æ®­å±æ”»æ“Šå‹•ç•«
                    document.getElementById('plantChar').classList.add('shake');
                    this.animateZombieAttack();
                }
                
                // æ¸…é™¤å‹•ç•«
                setTimeout(() => {
                    document.getElementById('plantChar').classList.remove('bounce', 'shake', 'glow');
                    document.querySelectorAll('.zombie-unit').forEach(z => z.classList.remove('bounce', 'shake'));
                }, 600);
                
                this.updateDisplay();
                
                // æª¢æŸ¥éŠæˆ²çµæŸæ¢ä»¶
                if (this.plantHealth <= 0) {
                    this.endGame('defeat');
                    return;
                } else if (this.getAliveZombieCount() === 0) {
                    this.nextLevel();
                    return;
                }
                
                // åªæœ‰ç­”å°æ‰ç”Ÿæˆæ–°é¡Œç›®
                                      
                if (isCorrect) {
                    setTimeout(() => {
                        this.generateQuestion();
                        messageEl.textContent = '';
                    }, 1500);
                } else {
                    setTimeout(() => {
                        messageEl.textContent = '';
                    }, 1500);
                }

                                                             
                                  
                                                 
                                                       
                                             
                             
            }

            triggerPlantSkill() {
                if (!this.currentPlant || !this.currentPlantName) return;
                
                const messageEl = document.getElementById('gameMessage');
                let skillMessage = '';
                let skillEffect = false;
                
                if (Math.random() < 0.3) {
                    switch(this.currentPlantName) {
                        case 'å‘æ—¥è‘µ':
                        case 'é™½å…‰è‡':
                        case 'é›™å‘æ—¥è‘µ':
                            this.score += 20;
                            skillMessage = `ğŸŒ» ${this.currentPlantName}æŠ€èƒ½ï¼šç”¢ç”Ÿé¡å¤–é™½å…‰ï¼+20åˆ†`;
                            skillEffect = true;
                            break;
                            
                        case 'è±Œè±†å°„æ‰‹':
                        case 'é›™ç™¼å°„æ‰‹':
                        case 'ä¸‰é‡å°„æ‰‹':
                            this.timeLeft += 3;
                            skillMessage = `ğŸŸ¢ ${this.currentPlantName}æŠ€èƒ½ï¼šå¿«é€Ÿå°„æ“Šï¼+3ç§’`;
                            skillEffect = true;
                            break;
                            
                        case 'å¯’å†°å°„æ‰‹':
                        case 'å†°è¥¿ç“œæŠ•æ‰‹':
                        case 'å†°å‡è˜‘è‡':
                            this.freezeOptions();
                            skillMessage = `â„ï¸ ${this.currentPlantName}æŠ€èƒ½ï¼šå†°å‡æ”»æ“Šï¼é¸é …è¢«å‡çµ`;
                            skillEffect = true;
                            break;
                            
                        case 'ç«ç‚¬æ¨':
                        case 'è¾£æ¤’':
                        case 'ç«é¾è‰':
                            this.attackZombies(true);
                            skillMessage = `ğŸ”¥ ${this.currentPlantName}æŠ€èƒ½ï¼šç«ç„°æ”»æ“Šï¼é€ æˆé¡å¤–å‚·å®³`;
                            skillEffect = true;
                            break;
                            
                        case 'çˆ†ç‚¸æ«»æ¡ƒ':
                        case 'èŠ¥æœ«ç‚¸å½ˆ':
                        case 'è˜‘è‡ç‚¸å½ˆ':
                            this.zombieArmy.forEach(zombie => {
                                if (zombie.alive) {
                                    zombie.health -= 15;
                                    if (zombie.health <= 0) {
                                        zombie.alive = false;
                                        zombie.health = 0;
                                    }
                                }
                            });
                            this.renderZombieArmy();
                            skillMessage = `ğŸ’¥ ${this.currentPlantName}æŠ€èƒ½ï¼šçˆ†ç‚¸æ”»æ“Šï¼ç¾¤é«”å‚·å®³`;
                            skillEffect = true;
                            break;
                            
                        case 'å …æœç‰†':
                        case 'é«˜å …æœç‰†':
                        case 'å—ç“œé ­':
                            this.plantHealth = Math.min(100, this.plantHealth + 20);
                            skillMessage = `ğŸ›¡ï¸ ${this.currentPlantName}æŠ€èƒ½ï¼šé˜²è­·å¼·åŒ–ï¼+20è¡€é‡`;
                            skillEffect = true;
                            break;
                            
                        case 'é­…æƒ‘è‡':
                        case 'æ¨¡ä»¿è€…':
                            const correctBtn = document.querySelector(`[data-answer="${this.currentAnswer}"]`);
                            if (correctBtn) {
                                correctBtn.style.border = '3px solid gold';
                                correctBtn.style.boxShadow = '0 0 15px gold';
                                setTimeout(() => {
                                    correctBtn.style.border = '';
                                    correctBtn.style.boxShadow = '';
                                }, 2000);
                            }
                            skillMessage = `ğŸ’œ ${this.currentPlantName}æŠ€èƒ½ï¼šé­…æƒ‘æç¤ºï¼æ­£ç¢ºç­”æ¡ˆç™¼å…‰`;
                            skillEffect = true;
                            break;
                            
                        case 'é‡‘ç›èŠ±':
                            this.score += 50;
                            skillMessage = `ğŸŒ¼ ${this.currentPlantName}æŠ€èƒ½ï¼šç”¢ç”Ÿé‡‘å¹£ï¼+50åˆ†`;
                            skillEffect = true;
                            break;
                            
                        case 'è˜‘è‡ç‡ˆ':
                            this.timeLeft += 5;
                            skillMessage = `ğŸ’¡ ${this.currentPlantName}æŠ€èƒ½ï¼šç…§æ˜é™¤éœ§ï¼+5ç§’`;
                            skillEffect = true;
                            break;
                            
                        default:
                            this.timeLeft += 2;
                            skillMessage = `âœ¨ ${this.currentPlantName}æŠ€èƒ½ï¼š${this.currentPlant.skill}ï¼+2ç§’`;
                            skillEffect = true;
                            break;
                    }
                    
                    if (skillEffect) {
                        messageEl.textContent += ` ${skillMessage}`;
                        messageEl.className += ' animate-pulse';
                        
                        document.getElementById('plantChar').classList.add('glow');
                        setTimeout(() => {
                            document.getElementById('plantChar').classList.remove('glow');
                        }, 1000);
                    }
                }
            }
                                                                          
                                                      
            attackZombies(isCritical = false) {
                const aliveZombies = this.zombieArmy.filter(z => z.alive);
                if (aliveZombies.length === 0) return;

                // éš¨æ©Ÿæ”»æ“Šä¸€éš»æ®­å±
                const targetZombie = aliveZombies[Math.floor(Math.random() * aliveZombies.length)];

                // Bosså—åˆ°çš„å‚·å®³è¼ƒå°‘ï¼Œæœƒå¿ƒä¸€æ“Šå‚·å®³åŠ å€
                let damage = targetZombie.isBoss ? 20 : 30;
                if (isCritical) {
                    damage *= 2;
                }
                
                targetZombie.health -= damage;
                
                if (targetZombie.health <= 0) {
                    targetZombie.alive = false;
                    targetZombie.health = 0;
                }
                
                // æ·»åŠ æ”»æ“Šå‹•ç•«
                const zombieEl = document.querySelector(`[data-zombie-id="${targetZombie.id}"]`);
                if (zombieEl) {
                    zombieEl.classList.add('shake');
                    if (isCritical) {
                        zombieEl.style.filter = 'brightness(2) saturate(2)';
                        setTimeout(() => {
                            zombieEl.style.filter = '';
                        }, 500);
                    }
                }
                
                this.renderZombieArmy();
            }

            animateZombieAttack() {
                const aliveZombieEls = document.querySelectorAll('.zombie-unit');
                aliveZombieEls.forEach(el => {
                    el.classList.add('bounce');
                });
            }

            getAliveZombieCount() {
                return this.zombieArmy.filter(z => z.alive).length;
            }

            nextLevel() {
                if (this.level == 15)
                {
                    this.endGame('victory');
                    return;
                }
                // æ–°å¢é—œå¡å®Œæˆæ­·å²ç´€éŒ„
                this.addToHistory(`é—œå¡ ${this.level} å®Œæˆï¼æº–å‚™é€²å…¥ä¸‹ä¸€é—œ`, 'success');
                
                this.level++;
                this.timeLeft = Math.max(15, 25 - Math.floor((this.level - 1) / 2) * 2); // æ™‚é–“è¶Šä¾†è¶Šå°‘ä½†æ›´åˆç†
                
                // é¡¯ç¤ºéå ´å‹•ç•«
                this.showTransition();
            }
            addToHistory () {
            }
            
            showTransition() {
                // æš«åœè¨ˆæ™‚å™¨é¿å…éå ´å‹•ç•«æ‰£æ™‚é–“
                if (this.timer) {
                    clearInterval(this.timer);
                }
                
                const gameArea = document.getElementById('gameArea');
                const transitionScreen = document.getElementById('transitionScreen');
                const transitionEmoji = document.getElementById('transitionEmoji');
                const transitionTitle = document.getElementById('transitionTitle');
                const transitionMessage = document.getElementById('transitionMessage');
                const transitionHint = document.getElementById('transitionHint');
                
                gameArea.classList.add('hidden');
                transitionScreen.classList.remove('hidden');
                
                // æ ¹æ“šé—œå¡é¡å‹è¨­ç½®ä¸åŒçš„éå ´æ•ˆæœ
                if (this.isBossLevel()) {
                    const boss = this.bossTypes[this.level];
                    transitionScreen.className = this.level === 10 ? 
                        'final-boss-bg rounded-xl p-8 shadow-2xl text-center' :
                        'boss-bg rounded-xl p-8 shadow-2xl text-center';
                    
                    transitionEmoji.textContent = boss.emoji;
                    transitionTitle.textContent = `Bossæˆ°ï¼`;
                    transitionMessage.textContent = `${boss.name} å‡ºç¾äº†ï¼`;
                    transitionHint.textContent = this.level === 10 ? 
                        'é€™æ˜¯æœ€çµ‚æ±ºæˆ°ï¼' : 
                        'å°å¿ƒï¼Bossçš„è¡€é‡å¾ˆåšï¼';
                } else {
                    transitionScreen.className = 'bg-gradient-to-b from-purple-900 via-blue-900 to-black rounded-xl p-8 shadow-2xl text-center';
                    transitionEmoji.textContent = 'ğŸŒŸ';
                    transitionTitle.textContent = `é—œå¡ ${this.level}`;
                    transitionMessage.textContent = 'æº–å‚™è¿æ¥ä¸‹ä¸€æ³¢æŒ‘æˆ°ï¼';
                    transitionHint.textContent = 'æ®­å±è»åœ˜è¶Šä¾†è¶Šå¼·å¤§äº†...';
                }
                
                // 3ç§’å¾Œé–‹å§‹æ–°é—œå¡
                setTimeout(() => {
                    transitionScreen.classList.add('hidden');
                    gameArea.classList.remove('hidden');
                    // å°æ©Ÿç‡è§¸ç™¼ç§˜å¯†é—œå¡ï¼ˆåƒè€ƒPvZå½©è›‹ï¼‰ï¼Œç¬¬å››é—œå¾Œ
                    //this.maybeTriggerSecretLevel();
                    this.createZombieArmy();
                    this.generateQuestion();
                    this.updateGameAreaStyle();

                    // é‡æ–°å•Ÿå‹•è¨ˆæ™‚å™¨
                    this.startTimer();
                }, 3000);
            }

            updateGameAreaStyle() {
                const gameArea = document.getElementById('gameArea');
                
                if (this.isBossLevel()) {
                    if (this.level === 10 || this.level === 15){
                        gameArea.className = 'final-boss-bg rounded-xl p-8 shadow-2xl';
                    } else {
                        gameArea.className = 'boss-bg rounded-xl p-8 shadow-2xl';
                    }
                } else {
                    gameArea.className = 'bg-white/95 rounded-xl p-8 shadow-2xl';
                }
            }

            maybeTriggerSecretLevel() {
                if (this.level >= 4 && Math.random() < 0.08) {
                    this.triggerSecretLevel();
                } else {
                    this.isSecretLevel = false;
                    const gameArea = document.getElementById('gameArea');
                    gameArea.style.filter = '';
                    gameArea.style.boxShadow = '';
                }
            }

            // ç§˜å¯†é—œå¡ï¼šå¤œé–“å¢“åœ°é¢¨æ ¼ï¼ŒæŠ€èƒ½é »ç‡æå‡
            triggerSecretLevel() {
                this.isSecretLevel = true;
                const gameArea = document.getElementById('gameArea');
                gameArea.style.filter = 'grayscale(0.15) brightness(0.95)';
                gameArea.style.boxShadow = 'inset 0 0 120px rgba(0,0,0,0.5)';
                const messageEl = document.getElementById('gameMessage');
                messageEl.textContent = 'ğŸŒ™ ç§˜å¯†é—œå¡ï¼šå¤œé–“å¢“åœ°ä¾†è¥²ï¼å°å¿ƒè¿·éœ§èˆ‡è©­ç•°æ®­å±...';
                messageEl.className = 'text-center text-lg font-bold h-8 text-indigo-700';
                setTimeout(() => {
                    if (messageEl.textContent.includes('ç§˜å¯†é—œå¡')) messageEl.textContent = '';
                }, 3000);
            }

            useUltimateSkill() {
                if (this.ultimateSkills <= 0 || !this.gameActive) return;
                
                this.ultimateSkills--;
                this.score += 50;
                this.plantHealth = Math.min(100, this.plantHealth + 30);
                
                // å¿…æ®ºæŠ€ä½¿ç”¨å¾Œå›å¾©æ²»ç™‚æŠ€èƒ½
                this.healSkills = Math.min(5, this.healSkills + 1);
                
                // å°æ‰€æœ‰æ´»è‘—çš„æ®­å±é€ æˆå‚·å®³
                let totalDamage = 0;
                this.zombieArmy.forEach(zombie => {
                    if (zombie.alive) {
                        // Bosså—åˆ°çš„å¿…æ®ºæŠ€å‚·å®³è¼ƒå°‘
                        const damage = zombie.isBoss ? 30 : 50;
                        zombie.health -= damage;
                        totalDamage += damage;
                        if (zombie.health <= 0) {
                            zombie.alive = false;
                            zombie.health = 0;
                        }
                    }
                });
                
                // æ–°å¢å¿…æ®ºæŠ€ä½¿ç”¨æ­·å²ç´€éŒ„
                this.addToHistory(`ä½¿ç”¨å¿…æ®ºæŠ€ï¼é€ æˆ ${totalDamage} é»ç¾¤é«”å‚·å®³ï¼Œå›å¾©30è¡€é‡ï¼Œæ²»ç™‚æŠ€èƒ½+1`, 'skill');
                
                const messageEl = document.getElementById('gameMessage');
                messageEl.textContent = 'âš¡ å¿…æ®ºæŠ€ç™¼å‹•ï¼é™½å…‰ç‚¸å½ˆç¾¤é«”æ”»æ“Šï¼ğŸ’– æ²»ç™‚æŠ€èƒ½+1';
                messageEl.className = 'text-center text-lg font-bold h-8 text-yellow-600';
                
                // ç‰¹æ•ˆå‹•ç•«
                document.getElementById('plantChar').classList.add('glow');
                document.querySelectorAll('.zombie-unit').forEach(el => {
                    el.classList.add('shake');
                });
                
                setTimeout(() => {
                    document.getElementById('plantChar').classList.remove('glow');
                    document.querySelectorAll('.zombie-unit').forEach(el => {
                        el.classList.remove('shake');
                    });
                    messageEl.textContent = '';
                }, 2000);
                
                this.renderZombieArmy();
                this.updateDisplay();
                
                if (this.getAliveZombieCount() === 0) {
                    this.nextLevel();
                }
            }

            useHealSkill() {
                if (this.healSkills <= 0 || !this.gameActive) return;
                
                this.healSkills--;
                this.plantHealth = Math.min(100, this.plantHealth + 50);
                this.timeLeft += 10; // é¡å¤–çå‹µæ™‚é–“
                
                // æ²»ç™‚æŠ€èƒ½ä½¿ç”¨å¾Œå›å¾©å¿…æ®ºæŠ€
                this.ultimateSkills = Math.min(3, this.ultimateSkills + 1);
                
                // æ–°å¢æ²»ç™‚æŠ€èƒ½ä½¿ç”¨æ­·å²ç´€éŒ„
                this.addToHistory('ä½¿ç”¨æ²»ç™‚è¡“ï¼å›å¾©50è¡€é‡ï¼Œæ™‚é–“+10ç§’ï¼Œå¿…æ®ºæŠ€+1', 'skill');
                
                const messageEl = document.getElementById('gameMessage');
                messageEl.textContent = 'ğŸ’– æ²»ç™‚è¡“ç™¼å‹•ï¼æ¤ç‰©æ¢å¾©å¥åº·ï¼â° +10ç§’ âš¡ å¿…æ®ºæŠ€+1';
                messageEl.className = 'text-center text-lg font-bold h-8 text-pink-600';
                
                // æ²»ç™‚ç‰¹æ•ˆå‹•ç•«
                document.getElementById('plantChar').classList.add('bounce');
                
                setTimeout(() => {
                    document.getElementById('plantChar').classList.remove('bounce');
                    messageEl.textContent = '';
                }, 2000);
                
                this.updateDisplay();
            }

            startTimer() {
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    this.updateDisplay();
                    
                    if (this.timeLeft <= 0) {
                        // æ™‚é–“åˆ°æ‰£è¡€è€Œä¸æ˜¯ç›´æ¥çµæŸéŠæˆ²
                        this.plantHealth = Math.max(0, this.plantHealth - 20);
                        this.timeLeft = Math.max(10, 20 - Math.floor(this.level / 3) * 2); // é‡ç½®æ™‚é–“ï¼Œé—œå¡è¶Šé«˜æ™‚é–“è¶Šå°‘
                        
                        const messageEl = document.getElementById('gameMessage');
                        messageEl.textContent = 'â° æ™‚é–“åˆ°ï¼æ¤ç‰©å—åˆ°å‚·å®³ï¼';
                        messageEl.className = 'text-center text-lg font-bold h-8 text-red-600';
                        
                        // æ¤ç‰©å—å‚·å‹•ç•«
                        document.getElementById('plantChar').classList.add('shake');
                        
                        setTimeout(() => {
                            document.getElementById('plantChar').classList.remove('shake');
                            messageEl.textContent = '';
                        }, 1500);
                        
                        this.updateDisplay();
                        
                        // æª¢æŸ¥æ˜¯å¦è¡€é‡æ­¸é›¶
                        if (this.plantHealth <= 0) {
                            this.endGame('defeat');
                        }
                    }
                }, 1000);
            }

            updateDisplay() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('timer').textContent = this.timeLeft;
                document.getElementById('questionCount').textContent = this.level;
                document.getElementById('zombieCount').textContent = this.getAliveZombieCount();
                document.getElementById('streakCount').textContent = this.correctStreak;
                document.getElementById('ultimateCount').textContent = this.ultimateSkills;
                document.getElementById('healCount').textContent = this.healSkills;
                document.getElementById('plantHealth').style.width = this.plantHealth + '%';
                document.getElementById('zombieStatus').textContent = `${this.getAliveZombieCount()}éš»æ®­å±å‰©é¤˜`;
                
                // è¡€é‡ä¸è¶³è­¦å‘Š
                const plantHealthBar = document.getElementById('plantHealth');
                if (this.plantHealth <= 30) {
                    plantHealthBar.className = 'h-full bg-red-500 transition-all duration-500 animate-pulse';
                    if (this.plantHealth <= 30 && this.plantHealth > 0) {
                        const messageEl = document.getElementById('gameMessage');
                        if (!messageEl.textContent.includes('è¡€é‡å±éšª')) {
                            messageEl.textContent = 'âš ï¸ è¡€é‡å±éšªï¼å¿«ä½¿ç”¨æ²»ç™‚è¡“ï¼';
                            messageEl.className = 'text-center text-lg font-bold h-8 text-red-600 animate-pulse';
                            setTimeout(() => {
                                if (messageEl.textContent.includes('è¡€é‡å±éšª')) {
                                    messageEl.textContent = '';
                                }
                            }, 3000);
                        }
                    }
                } else if (this.plantHealth <= 50) {
                    plantHealthBar.className = 'h-full bg-yellow-500 transition-all duration-500';
                } else {
                    plantHealthBar.className = 'h-full bg-green-500 transition-all duration-500';
                }
                
                // æ›´æ–°å¿…æ®ºæŠ€æŒ‰éˆ•ç‹€æ…‹
                const ultimateBtn = document.getElementById('ultimateBtn');
                if (this.ultimateSkills <= 0) {
                    ultimateBtn.disabled = true;
                    ultimateBtn.classList.add('opacity-50');
                    ultimateBtn.classList.remove('glow');
                } else {
                    ultimateBtn.disabled = false;
                    ultimateBtn.classList.remove('opacity-50');
                }
                
                // æ›´æ–°æ²»ç™‚æŠ€èƒ½æŒ‰éˆ•ç‹€æ…‹
                const healBtn = document.getElementById('healBtn');
                if (this.healSkills <= 0) {
                    healBtn.disabled = true;
                    healBtn.classList.add('opacity-50');
                } else {
                    healBtn.disabled = false;
                    healBtn.classList.remove('opacity-50');
                }
            }

            endGame(reason) {
                this.gameActive = false;
                clearInterval(this.timer);
                if (this.zombieSkillTimer) {
                    clearInterval(this.zombieSkillTimer);
                }
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }
                
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('gameOverScreen').classList.remove('hidden');
                
                const gameOverEmoji = document.getElementById('gameOverEmoji');
                const gameOverTitle = document.getElementById('gameOverTitle');
                const gameOverMessage = document.getElementById('gameOverMessage');
                
                switch (reason) {
                    case 'victory':
                        gameOverEmoji.textContent = 'ğŸ‰';
                        gameOverTitle.textContent = 'å‹åˆ©ï¼';
                        gameOverMessage.textContent = 'ä½ æˆåŠŸæ“Šæ•—äº†æ•¸å­¸æ®­å±ï¼';
                        break;
                    case 'defeat':
                        gameOverEmoji.textContent = 'ğŸ’€';
                        gameOverTitle.textContent = 'å¤±æ•—ï¼';
                        gameOverMessage.textContent = 'æ®­å±æ”»ç ´äº†é˜²ç·š...å†è©¦ä¸€æ¬¡å§ï¼';
                        break;
                    case 'timeout':
                        gameOverEmoji.textContent = 'â°';
                        gameOverTitle.textContent = 'æ™‚é–“åˆ°ï¼';
                        gameOverMessage.textContent = 'æ™‚é–“ç”¨å®Œäº†ï¼å¿«é€Ÿè¨ˆç®—æ˜¯é—œéµï¼';
                        break;
                    case 'complete':
                        gameOverEmoji.textContent = 'ğŸ†';
                        gameOverTitle.textContent = 'å®Œæˆï¼';
                        gameOverMessage.textContent = 'ä½ å®Œæˆäº†æ‰€æœ‰é¡Œç›®ï¼çœŸå²å®³ï¼';
                        break;
                }
                
                document.getElementById('finalScore').textContent = `æœ€çµ‚åˆ†æ•¸: ${this.score}`;
            }

            restartGame() {
                // é‡ç½®æ‰€æœ‰æ•¸å€¼
                this.score = 0;
                this.timeLeft = 30;
                this.level = 1;
                this.ultimateSkills = 3;
                this.healSkills = 5;
                this.plantHealth = 100;
                this.zombieArmy = [];
                this.optionCount = 4;
                this.gameActive = false;
                this.gameMode = null;
                this.difficulty = null;
                this.hiddenOptions = [];
                this.correctStreak = 0;
                this.currentPlant = null;
                this.currentPlantName = null;
                this.isRescueLevel = false;
                 
                if (this.timer) {
                    clearInterval(this.timer);
                }
                if (this.zombieSkillTimer) {
                    clearInterval(this.zombieSkillTimer);
                }
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }

                document.body.className = 'min-h-screen bg-gradient-to-b from-green-400 via-green-500 to-green-600';

                // é‡ç½®è§’è‰²
                
                document.getElementById('plantChar').textContent = 'ğŸŒ»';
                document.getElementById('plantName').textContent = 'å®ˆè­·æ¤ç‰©';

                // é‡ç½®æ¨™é¡Œ
                document.getElementById('gameSubtitle').textContent = 'æ•¸å­¸å¤§ä½œæˆ°';

                // é¡¯ç¤ºæ¨¡å¼é¸æ“‡ï¼Œéš±è—å…¶ä»–ç•«é¢
                document.getElementById('modeSelection').classList.remove('hidden');
                document.getElementById('difficultySelection').classList.add('hidden');
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('gameOverScreen').classList.add('hidden');
                document.getElementById('transitionScreen').classList.add('hidden');
                document.getElementById('rescueScreen').classList.add('hidden');

                // é‡ç½®éŠæˆ²å€åŸŸæ¨£å¼
                const gameArea = document.getElementById('gameArea');
                gameArea.className = 'bg-white/95 rounded-xl p-8 shadow-2xl hidden';
                gameArea.style.filter = '';
                gameArea.style.opacity = '';
                gameArea.style.boxShadow = '';
                gameArea.classList.remove('animate-pulse');
            }
        }

        // å•Ÿå‹•éŠæˆ²
        window.addEventListener('DOMContentLoaded', () => {
            //window.game = new MathZombieGame();
            new MathZombieGame();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97828fc5e1f6dc87',t:'MTc1NjcwNjU3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
