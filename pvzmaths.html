<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤ç‰©å¤§æˆ°æ®­å± - ä¹ä¹ä¹˜æ³•è¡¨éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #10b981; }
            50% { box-shadow: 0 0 20px #10b981, 0 0 30px #10b981; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes bossGlow {
            0%, 100% { box-shadow: 0 0 10px #dc2626, 0 0 20px #dc2626; }
            50% { box-shadow: 0 0 30px #dc2626, 0 0 50px #dc2626, 0 0 70px #dc2626; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes rescueGlow {
            0%, 100% { box-shadow: 0 0 10px #fbbf24, 0 0 20px #fbbf24; }
            50% { box-shadow: 0 0 30px #fbbf24, 0 0 50px #fbbf24, 0 0 70px #fbbf24; }
        }
        .bounce { animation: bounce 0.6s; }
        .shake { animation: shake 0.5s; }
        .glow { animation: glow 1s infinite; }
        .fadeInUp { animation: fadeInUp 0.8s ease-out; }
        .slideInLeft { animation: slideInLeft 0.8s ease-out; }
        .slideInRight { animation: slideInRight 0.8s ease-out; }
        .pulse { animation: pulse 2s infinite; }
        .bossGlow { animation: bossGlow 1.5s infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .rescueGlow { animation: rescueGlow 1.5s infinite; }
        .plant-bg { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .zombie-bg { background: linear-gradient(135deg, #dc2626, #991b1b); }
        .boss-bg { background: linear-gradient(135deg, #7c2d12, #451a03); }
        .final-boss-bg { background: linear-gradient(135deg, #1e1b4b, #0f0a19); }
        .rescue-bg { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-green-400 via-green-500 to-green-600">
    <!-- éŠæˆ²æ¨™é¡Œ -->
    <div class="text-center py-6">
        <h1 class="text-4xl font-bold text-white mb-2">ğŸŒ» æ¤ç‰©å¤§æˆ°æ®­å± ğŸ§Ÿâ€â™‚ï¸</h1>
        <h2 class="text-2xl font-semibold text-yellow-200" id="gameSubtitle">æ•¸å­¸å¤§ä½œæˆ°</h2>
    </div>

    <!-- éŠæˆ²ç‹€æ…‹æ¬„ -->
    <div class="max-w-4xl mx-auto px-4 mb-6">
        <div class="bg-white/90 rounded-lg p-4 shadow-lg">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div class="flex items-center space-x-4">
                    <div class="text-lg font-bold text-green-700">
                        ğŸŒ± åˆ†æ•¸: <span id="score" class="text-2xl">0</span>
                    </div>
                    <div class="text-lg font-bold text-blue-700">
                        â° æ™‚é–“: <span id="timer" class="text-2xl">30</span>ç§’
                    </div>
                    <div class="text-lg font-bold text-purple-700">
                        ğŸ¯ é—œå¡: <span id="questionCount" class="text-2xl">1</span>
                    </div>
                    <div class="text-lg font-bold text-red-700">
                        ğŸ§Ÿâ€â™‚ï¸ æ®­å±: <span id="zombieCount" class="text-2xl">3</span>éš»
                    </div>
                    <div class="text-lg font-bold text-orange-700">
                        ğŸ”¥ é€£æ“Š: <span id="streakCount" class="text-2xl">0</span>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="restartBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-700 transition-all">
                        ğŸ”„ é‡æ–°é–‹å§‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²ä¸»å€åŸŸ -->
    <div class="max-w-4xl mx-auto px-4">
        <!-- éŠæˆ²å€åŸŸ -->
            <!-- æ¨¡å¼é¸æ“‡ç•«é¢ -->
            <div id="modeSelection" class="bg-white/95 rounded-xl p-8 shadow-2xl text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">ğŸ® é¸æ“‡éŠæˆ²æ¨¡å¼</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <button id="multiplicationMode" class="mode-btn bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-xl text-xl font-bold hover:from-blue-600 hover:to-purple-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">âœ–ï¸</div>
                    <div class="text-2xl mb-2">ä¹ä¹ä¹˜æ³•è¡¨</div>
                    <div class="text-sm opacity-90">æŒ‘æˆ°ä¹˜æ³•é‹ç®—</div>
                </button>
                <button id="addSubMode" class="mode-btn bg-gradient-to-r from-green-500 to-teal-600 text-white p-6 rounded-xl text-xl font-bold hover:from-green-600 hover:to-teal-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">â•â–</div>
                    <div class="text-2xl mb-2">å–®ä½æ•¸åŠ æ¸›</div>
                    <div class="text-sm opacity-90">ç·´ç¿’åŠ æ¸›é‹ç®—</div>
                </button>
                <button id="mixedMode" class="mode-btn bg-gradient-to-r from-red-500 to-pink-600 text-white p-6 rounded-xl text-xl font-bold hover:from-red-600 hover:to-pink-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸ¯</div>
                    <div class="text-2xl mb-2">æ··åˆæ¨¡å¼</div>
                    <div class="text-sm opacity-90">çµ‚æ¥µæŒ‘æˆ°</div>
                </button>
            </div>
            <div class="text-gray-600">
                <p class="mb-2">ğŸŒŸ é¸æ“‡ä½ æƒ³è¦æŒ‘æˆ°çš„æ•¸å­¸æ¨¡å¼</p>
                <p>æ¯ç¨®æ¨¡å¼éƒ½æœ‰ç¨ç‰¹çš„Bosså’ŒæŒ‘æˆ°ï¼</p>
            </div>
        </div>

        <!-- é›£åº¦é¸æ“‡ç•«é¢ -->
        <div id="difficultySelection" class="bg-white/95 rounded-xl p-8 shadow-2xl text-center hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">âš”ï¸ é¸æ“‡é›£åº¦ç­‰ç´š</h2>
            <div class="text-lg text-gray-600 mb-8" id="selectedModeText">å·²é¸æ“‡ï¼šä¹ä¹ä¹˜æ³•è¡¨</div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <button id="easyDifficulty" class="difficulty-btn bg-gradient-to-r from-green-400 to-green-600 text-white p-6 rounded-xl text-xl font-bold hover:from-green-500 hover:to-green-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸŒ±</div>
                    <div class="text-2xl mb-2">ç°¡å–®</div>
                    <div class="text-sm opacity-90 mb-2">æ®­å±è¡€é‡ï¼š50</div>
                    <div class="text-xs opacity-80">æ®­å±æ²’æœ‰ç‰¹æ®ŠæŠ€èƒ½</div>
                </button>
                <button id="normalDifficulty" class="difficulty-btn bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-6 rounded-xl text-xl font-bold hover:from-yellow-500 hover:to-orange-600 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸŒ»</div>
                    <div class="text-2xl mb-2">æ™®é€š</div>
                    <div class="text-sm opacity-90 mb-2">æ®­å±è¡€é‡ï¼š75</div>
                    <div class="text-xs opacity-80">æ®­å±æœ‰åŸºæœ¬æŠ€èƒ½</div>
                </button>
                <button id="hardDifficulty" class="difficulty-btn bg-gradient-to-r from-red-500 to-purple-600 text-white p-6 rounded-xl text-xl font-bold hover:from-red-600 hover:to-purple-700 transition-all shadow-lg transform hover:scale-105">
                    <div class="text-4xl mb-3">ğŸ”¥</div>
                    <div class="text-2xl mb-2">å›°é›£</div>
                    <div class="text-sm opacity-90 mb-2">æ®­å±è¡€é‡ï¼š100</div>
                    <div class="text-xs opacity-80">æ®­å±æŠ€èƒ½é »ç¹ç™¼å‹•</div>
                </button>
            </div>
            
            <div class="bg-gray-100 rounded-lg p-4 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-3">ğŸ§Ÿâ€â™‚ï¸ æ®­å±æŠ€èƒ½èªªæ˜</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-700">
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸ‘»</span>
                        <span>éš±èº«è¡“ï¼šéš±è—é¸é …</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸŒªï¸</span>
                        <span>æ··äº‚è¡“ï¼šæ‰“äº‚é †åº</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">â°</span>
                        <span>æ™‚é–“è©›å’’ï¼šæ¸›å°‘æ™‚é–“</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸ­</span>
                        <span>å½è£è¡“ï¼šæ”¹è®Šå¤–è§€</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">â„ï¸</span>
                        <span>å†°å‡è¡“ï¼šå‡çµé¸é …</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸŒ«ï¸</span>
                        <span>è‡´ç›²è¡“ï¼šæ¨¡ç³Šè¦–ç·š</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸŒ€</span>
                        <span>æ··æ·†è¡“ï¼šæ—‹è½‰é¸é …</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸª</span>
                        <span>åˆ†èº«è¡“ï¼šå‡é¸é …</span>
                    </div>
                    <div class="flex items-center">
                        <span class="text-lg mr-2">ğŸ“š</span>
                        <span>æ–‡å­—é¡Œï¼šBosså°ˆå±¬æŠ€èƒ½</span>
                    </div>
                </div>
            </div>
            
            <button id="backToModeBtn" class="bg-gray-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-gray-600 transition-all mr-4">
                â† è¿”å›æ¨¡å¼é¸æ“‡
            </button>
        </div>

        <div id="gameArea" class="bg-white/95 rounded-xl p-8 shadow-2xl hidden">
            <!-- è§’è‰²å€åŸŸ -->
            <div class="flex justify-between items-center mb-8">
                <div class="text-center">
                    <div class="text-6xl mb-2" id="plantChar">ğŸŒ»</div>
                    <div class="text-lg font-bold text-green-700">å®ˆè­·æ¤ç‰©</div>
                    <div class="w-32 h-4 bg-gray-300 rounded-full overflow-hidden">
                        <div id="plantHealth" class="h-full bg-green-500 transition-all duration-500" style="width: 100%"></div>
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="text-4xl font-bold text-gray-700 mb-4">VS</div>
                    <div class="text-lg text-gray-600">æ®­å±è»åœ˜</div>
                </div>
                
                <div class="text-center">
                    <div class="text-lg font-bold text-red-700 mb-2">æ•¸å­¸æ®­å±è»åœ˜</div>
                    <div id="zombieArmy" class="flex flex-wrap justify-center gap-2 mb-2">
                        <div class="zombie-unit text-4xl" data-health="100">ğŸ§Ÿâ€â™‚ï¸</div>
                        <div class="zombie-unit text-4xl" data-health="100">ğŸ§Ÿâ€â™€ï¸</div>
                        <div class="zombie-unit text-4xl" data-health="100">ğŸ‘»</div>
                    </div>
                    <div class="text-sm text-red-600" id="zombieStatus">3éš»æ®­å±å‰©é¤˜</div>
                </div>
            </div>

            <!-- é¡Œç›®å€åŸŸ -->
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4" id="questionTitle">ğŸ§® æ•¸å­¸æŒ‘æˆ°</h3>
                    <div class="text-4xl font-bold mb-4" id="question">5 + 3 = ?</div>
                    <div class="text-lg" id="questionHint">é¸æ“‡æ­£ç¢ºç­”æ¡ˆä¾†æ”»æ“Šæ®­å±ï¼</div>
                </div>
            </div>

            <!-- é¸é …å€åŸŸ -->
            <div id="optionsArea" class="grid gap-4 mb-6">
                <!-- å‹•æ…‹ç”Ÿæˆé¸é …æŒ‰éˆ• -->
            </div>

            <!-- æŠ€èƒ½å€åŸŸ -->
            <div class="text-center mb-6">
                <div class="flex justify-center gap-4 flex-wrap">
                    <button id="ultimateBtn" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-3 rounded-xl text-lg font-bold shadow-2xl hover:from-yellow-500 hover:to-orange-600 transition-all glow transform hover:scale-105" disabled>
                        âš¡ é™½å…‰ç‚¸å½ˆ âš¡<br>
                        <span class="text-sm">å‰©é¤˜ <span id="ultimateCount">3</span> æ¬¡</span>
                    </button>
                    <button id="healBtn" class="bg-gradient-to-r from-pink-400 to-red-500 text-white px-6 py-3 rounded-xl text-lg font-bold shadow-2xl hover:from-pink-500 hover:to-red-600 transition-all transform hover:scale-105" disabled>
                        ğŸ’– æ²»ç™‚è¡“ ğŸ’–<br>
                        <span class="text-sm">å‰©é¤˜ <span id="healCount">5</span> æ¬¡</span>
                    </button>
                </div>
            </div>

            <!-- éŠæˆ²è¨Šæ¯ -->
            <div id="gameMessage" class="text-center text-lg font-bold h-8"></div>
        </div>

        <!-- éå ´å‹•ç•«ç•«é¢ -->
        <div id="transitionScreen" class="bg-gradient-to-b from-purple-900 via-blue-900 to-black rounded-xl p-8 shadow-2xl text-center hidden">
            <div class="text-8xl mb-6 pulse" id="transitionEmoji">ğŸŒŸ</div>
            <h2 class="text-4xl font-bold text-white mb-4 fadeInUp" id="transitionTitle">é—œå¡å®Œæˆï¼</h2>
            <div class="text-2xl text-yellow-300 mb-6 slideInLeft" id="transitionMessage">æº–å‚™è¿æ¥ä¸‹ä¸€æ³¢æŒ‘æˆ°ï¼</div>
            <div class="text-lg text-gray-300 slideInRight" id="transitionHint">æ–°çš„æ•µäººæ­£åœ¨é€¼è¿‘...</div>
        </div>

        <!-- æ‹¯æ•‘æˆ´å¤«é—œå¡ç•«é¢ -->
        <div id="rescueScreen" class="rescue-bg rounded-xl p-8 shadow-2xl text-center hidden">
            <div class="text-8xl mb-6 float rescueGlow">ğŸ§‘â€ğŸŒ¾</div>
            <h2 class="text-4xl font-bold text-white mb-4 fadeInUp">æ‹¯æ•‘æˆ´å¤«ï¼</h2>
            <div class="text-2xl text-yellow-100 mb-6 slideInLeft">æˆ´å¤«è¢«æ±½çƒæ®­å±æŠ“èµ°äº†ï¼</div>
            <div class="text-lg text-yellow-200 mb-8 slideInRight">å¿«é€Ÿç­”å°é¡Œç›®ä¾†æ‹¯æ•‘ä»–ï¼</div>
            <div class="bg-white/20 rounded-lg p-4 mb-6">
                <div class="text-xl font-bold text-white mb-2">ğŸˆ æ±½çƒæ®­å±è¡€é‡ï¼š<span id="balloonZombieHealth">150</span></div>
                <div class="w-full h-4 bg-gray-700 rounded-full overflow-hidden">
                    <div id="balloonHealthBar" class="h-full bg-red-500 transition-all duration-500" style="width: 100%"></div>
                </div>
            </div>
        </div>

        <!-- éŠæˆ²çµæŸç•«é¢ -->
        <div id="gameOverScreen" class="bg-white/95 rounded-xl p-8 shadow-2xl text-center hidden">
            <div class="text-6xl mb-4" id="gameOverEmoji">ğŸ‰</div>
            <h2 class="text-3xl font-bold mb-4" id="gameOverTitle">éŠæˆ²çµæŸï¼</h2>
            <div class="text-xl mb-6" id="finalScore">æœ€çµ‚åˆ†æ•¸: 0</div>
            <div class="text-lg mb-6" id="gameOverMessage">ä½ æˆåŠŸä¿è­·äº†èŠ±åœ’ï¼</div>
            <button id="playAgainBtn" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-3 rounded-xl text-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all shadow-lg">
                ğŸŒ± å†ç©ä¸€æ¬¡
            </button>
        </div>
        </div>
    </div>

    <script>
        class MathZombieGame {
            constructor() {
                this.score = 0;
                this.timeLeft = 30;
                this.level = 1;
                this.ultimateSkills = 3;
                this.healSkills = 5;
                this.currentAnswer = 0;
                this.plantHealth = 100;
                this.gameActive = false;
                this.timer = null;
                this.zombieArmy = [];
                this.optionCount = 4; // åˆå§‹é¸é …æ•¸é‡
                this.gameMode = null; // 'multiplication', 'addSub', 'mixed'
                this.difficulty = null; // 'easy', 'normal', 'hard'
                this.zombieSkillTimer = null;
                this.hiddenOptions = [];
                this.questionTimer = null;
                this.questionStartTime = 0;
                this.correctStreak = 0; // é€£çºŒç­”å°æ¬¡æ•¸
                this.currentQuestionType = 'math'; // 'math' or 'text'
                this.textQuestions = []; // æ–‡å­—é¡Œåº«
                this.isRescueLevel = false; // æ˜¯å¦ç‚ºæ‹¯æ•‘é—œå¡
                this.balloonZombieHealth = 150; // æ±½çƒæ®­å±è¡€é‡
                
                this.plants = ['ğŸŒ»', 'ğŸŒ±', 'ğŸŒ¿', 'ğŸ„', 'ğŸŒµ', 'ğŸŒº', 'ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒ·'];
                this.zombieTypes = ['ğŸ§Ÿâ€â™‚ï¸', 'ğŸ§Ÿâ€â™€ï¸', 'ğŸ‘»', 'ğŸ’€', 'ğŸƒ', 'ğŸ‘¹', 'ğŸ¤–', 'ğŸ‘¾', 'ğŸ¦‡', 'ğŸˆ'];
                this.bossTypes = {
                    3: { emoji: 'ğŸ§ª', name: 'æ®­å±åšå£«', health: 200 },
                    5: { emoji: 'ğŸ¦¸â€â™‚ï¸', name: 'è¶…äººæ®­å±', health: 250 },
                    7: { emoji: 'âš¡', name: 'é›·é›»æ®­å±', health: 300 },
                    9: { emoji: 'â„ï¸', name: 'å†°éœœæ®­å±', health: 350 },
                    10: { emoji: 'ğŸ’€', name: 'çµ‚æ¥µé­”ç‹', health: 500 }
                };
                this.balloonZombie = { emoji: 'ğŸˆ', name: 'æ±½çƒæ®­å±', health: 150 };
                this.difficultySettings = {
                    easy: { zombieHealth: 50, bossHealthMultiplier: 0.6, skillChance: 0 },
                    normal: { zombieHealth: 75, bossHealthMultiplier: 0.8, skillChance: 0.3 },
                    hard: { zombieHealth: 100, bossHealthMultiplier: 1.0, skillChance: 0.6 }
                };
                
                // åˆå§‹åŒ–æ–‡å­—é¡Œåº«
                this.initializeTextQuestions();
                this.optionColors = [
                    'from-green-400 to-green-500 hover:from-green-500 hover:to-green-600',
                    'from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600',
                    'from-purple-400 to-purple-500 hover:from-purple-500 hover:to-purple-600',
                    'from-pink-400 to-pink-500 hover:from-pink-500 hover:to-pink-600',
                    'from-red-400 to-red-500 hover:from-red-500 hover:to-red-600',
                    'from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600',
                    'from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600',
                    'from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600'
                ];
                
                this.bindModeSelection();
            }



            initializeTextQuestions() {
                this.textQuestions = {
                    multiplication: [
                        { question: "6 Ã— 7 = ?", answer: 42, options: [35, 42, 48, 49] },
                        { question: "8 Ã— 9 = ?", answer: 72, options: [63, 72, 81, 64] },
                        { question: "4 Ã— 6 = ?", answer: 24, options: [20, 24, 28, 30] },
                        { question: "7 Ã— 5 = ?", answer: 35, options: [30, 35, 40, 32] },
                        { question: "9 Ã— 4 = ?", answer: 36, options: [32, 36, 40, 45] },
                        { question: "3 Ã— 8 = ?", answer: 24, options: [21, 24, 27, 32] },
                        { question: "6 Ã— 9 = ?", answer: 54, options: [48, 54, 63, 56] },
                        { question: "7 Ã— 7 = ?", answer: 49, options: [42, 49, 56, 48] }
                    ],
                    addSub: [
                        { question: "8 + 7 = ?", answer: 15, options: [14, 15, 16, 17] },
                        { question: "9 - 4 = ?", answer: 5, options: [4, 5, 6, 7] },
                        { question: "6 + 8 = ?", answer: 14, options: [12, 14, 16, 13] },
                        { question: "15 - 7 = ?", answer: 8, options: [7, 8, 9, 6] },
                        { question: "9 + 6 = ?", answer: 15, options: [14, 15, 16, 13] },
                        { question: "12 - 5 = ?", answer: 7, options: [6, 7, 8, 9] },
                        { question: "7 + 9 = ?", answer: 16, options: [15, 16, 17, 14] },
                        { question: "14 - 6 = ?", answer: 8, options: [7, 8, 9, 10] }
                    ],
                    mixed: [
                        { question: "5 Ã— 4 = ?", answer: 20, options: [16, 20, 24, 18] },
                        { question: "13 - 8 = ?", answer: 5, options: [4, 5, 6, 7] },
                        { question: "7 + 6 = ?", answer: 13, options: [12, 13, 14, 11] },
                        { question: "3 Ã— 9 = ?", answer: 27, options: [24, 27, 30, 21] },
                        { question: "16 - 9 = ?", answer: 7, options: [6, 7, 8, 5] },
                        { question: "8 + 5 = ?", answer: 13, options: [12, 13, 14, 15] },
                        { question: "6 Ã— 8 = ?", answer: 48, options: [42, 48, 54, 40] },
                        { question: "11 - 4 = ?", answer: 7, options: [6, 7, 8, 9] }
                    ]
                };
            }

            bindModeSelection() {
                document.getElementById('multiplicationMode').addEventListener('click', () => this.selectMode('multiplication'));
                document.getElementById('addSubMode').addEventListener('click', () => this.selectMode('addSub'));
                document.getElementById('mixedMode').addEventListener('click', () => this.selectMode('mixed'));
                
                document.getElementById('easyDifficulty').addEventListener('click', () => this.startGame('easy'));
                document.getElementById('normalDifficulty').addEventListener('click', () => this.startGame('normal'));
                document.getElementById('hardDifficulty').addEventListener('click', () => this.startGame('hard'));
                document.getElementById('backToModeBtn').addEventListener('click', () => this.backToModeSelection());
            }

            selectMode(mode) {
                this.gameMode = mode;
                
                // æ›´æ–°é¸æ“‡çš„æ¨¡å¼æ–‡å­—
                const modeNames = {
                    'multiplication': 'ä¹ä¹ä¹˜æ³•è¡¨',
                    'addSub': 'å–®ä½æ•¸åŠ æ¸›',
                    'mixed': 'æ··åˆæ¨¡å¼'
                };
                document.getElementById('selectedModeText').textContent = `å·²é¸æ“‡ï¼š${modeNames[mode]}`;
                
                // é¡¯ç¤ºé›£åº¦é¸æ“‡ï¼Œéš±è—æ¨¡å¼é¸æ“‡
                document.getElementById('modeSelection').classList.add('hidden');
                document.getElementById('difficultySelection').classList.remove('hidden');
            }

            backToModeSelection() {
                document.getElementById('difficultySelection').classList.add('hidden');
                document.getElementById('modeSelection').classList.remove('hidden');
                this.gameMode = null;
            }

            startGame(difficulty) {
                this.difficulty = difficulty;
                
                // æ›´æ–°æ¨™é¡Œ
                const subtitle = document.getElementById('gameSubtitle');
                const questionTitle = document.getElementById('questionTitle');
                const difficultyText = { easy: 'ç°¡å–®', normal: 'æ™®é€š', hard: 'å›°é›£' }[difficulty];
                
                switch(this.gameMode) {
                    case 'multiplication':
                        subtitle.textContent = `ä¹ä¹ä¹˜æ³•è¡¨å¤§ä½œæˆ° (${difficultyText})`;
                        questionTitle.textContent = 'âœ–ï¸ ä¹˜æ³•æŒ‘æˆ°';
                        break;
                    case 'addSub':
                        subtitle.textContent = `åŠ æ¸›æ³•å¤§ä½œæˆ° (${difficultyText})`;
                        questionTitle.textContent = 'â•â– åŠ æ¸›æ³•æŒ‘æˆ°';
                        break;
                    case 'mixed':
                        subtitle.textContent = `æ··åˆæ¨¡å¼å¤§ä½œæˆ° (${difficultyText})`;
                        questionTitle.textContent = 'ğŸ¯ æ··åˆæŒ‘æˆ°';
                        break;
                }
                
                // éš±è—é›£åº¦é¸æ“‡ï¼Œé¡¯ç¤ºéŠæˆ²
                document.getElementById('difficultySelection').classList.add('hidden');
                document.getElementById('gameArea').classList.remove('hidden');
                
                this.initializeGame();
                this.bindEvents();
                
                // æª¢æŸ¥æ˜¯å¦è§¸ç™¼æ‹¯æ•‘é—œå¡ (15% æ©Ÿç‡)
                if (Math.random() < 0.15) {
                    this.triggerRescueLevel();
                }
            }

            triggerRescueLevel() {
                this.isRescueLevel = true;
                this.balloonZombieHealth = 150;
                
                // éš±è—éŠæˆ²å€åŸŸï¼Œé¡¯ç¤ºæ‹¯æ•‘ç•«é¢
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('rescueScreen').classList.remove('hidden');
                
                // 3ç§’å¾Œé–‹å§‹æ‹¯æ•‘é—œå¡
                setTimeout(() => {
                    document.getElementById('rescueScreen').classList.add('hidden');
                    document.getElementById('gameArea').classList.remove('hidden');
                    
                    // è¨­ç½®æ‹¯æ•‘é—œå¡çš„ç‰¹æ®ŠèƒŒæ™¯
                    document.getElementById('gameArea').className = 'rescue-bg rounded-xl p-8 shadow-2xl rescueGlow';
                    
                    this.initializeRescueGame();
                }, 3000);
            }

            initializeRescueGame() {
                // å‰µå»ºæ±½çƒæ®­å±
                this.zombieArmy = [{
                    id: 0,
                    type: this.balloonZombie.emoji,
                    name: this.balloonZombie.name,
                    health: this.balloonZombieHealth,
                    maxHealth: this.balloonZombieHealth,
                    alive: true,
                    isBoss: true,
                    isBalloon: true,
                    skillCooldown: 0
                }];
                
                this.renderZombieArmy();
                this.updateDisplay();
                this.generateQuestion();
                this.startTimer();
                this.gameActive = true;
            }

            initializeGame() {
                this.createZombieArmy();
                this.updateDisplay();
                this.generateQuestion();
                this.startTimer();
                this.gameActive = true;
            }

            createZombieArmy() {
                this.zombieArmy = [];
                const settings = this.difficultySettings[this.difficulty];
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºBossé—œå¡
                if (this.isBossLevel()) {
                    const boss = this.bossTypes[this.level];
                    const bossHealth = Math.floor(boss.health * settings.bossHealthMultiplier);
                    this.zombieArmy.push({
                        id: 0,
                        type: boss.emoji,
                        name: boss.name,
                        health: bossHealth,
                        maxHealth: bossHealth,
                        alive: true,
                        isBoss: true,
                        skillCooldown: 0
                    });
                } else {
                    // æ™®é€šé—œå¡ï¼šæ ¹æ“šé—œå¡æ±ºå®šæ®­å±æ•¸é‡ (3-8éš»)
                    const zombieCount = Math.min(3 + this.level - 1, 8);
                    
                    for (let i = 0; i < zombieCount; i++) {
                        this.zombieArmy.push({
                            id: i,
                            type: this.zombieTypes[Math.floor(Math.random() * this.zombieTypes.length)],
                            health: settings.zombieHealth,
                            maxHealth: settings.zombieHealth,
                            alive: true,
                            isBoss: false,
                            skillCooldown: 0
                        });
                    }
                }
                
                this.renderZombieArmy();
                this.startZombieSkills();
            }

            isBossLevel() {
                return [3, 5, 7, 9, 10].includes(this.level);
            }

            renderZombieArmy() {
                const armyContainer = document.getElementById('zombieArmy');
                armyContainer.innerHTML = '';
                
                this.zombieArmy.forEach(zombie => {
                    if (zombie.alive) {
                        const zombieEl = document.createElement('div');
                        
                        if (zombie.isBoss) {
                            const bossClass = zombie.isBalloon ? 'zombie-unit text-6xl transition-all duration-300 float rescueGlow pulse' : 'zombie-unit text-6xl transition-all duration-300 bossGlow pulse';
                            zombieEl.className = bossClass;
                            const healthBarColor = zombie.isBalloon ? 'bg-yellow-500' : 'bg-red-500';
                            zombieEl.innerHTML = `
                                <div class="text-center">
                                    <div class="text-6xl mb-1">${zombie.type}</div>
                                    <div class="text-sm ${zombie.isBalloon ? 'text-yellow-300' : 'text-red-300'} font-bold">${zombie.name}</div>
                                    <div class="w-20 h-2 bg-gray-700 rounded-full mx-auto mt-1">
                                        <div class="h-full ${healthBarColor} rounded-full transition-all" style="width: ${(zombie.health / zombie.maxHealth) * 100}%"></div>
                                    </div>
                                </div>
                            `;
                        } else {
                            zombieEl.className = 'zombie-unit text-4xl transition-all duration-300';
                            zombieEl.innerHTML = `
                                <div class="text-center">
                                    <div class="text-4xl mb-1">${zombie.type}</div>
                                    <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto">
                                        <div class="h-full bg-red-500 rounded-full transition-all" style="width: ${(zombie.health / zombie.maxHealth) * 100}%"></div>
                                    </div>
                                </div>
                            `;
                            
                            // æ ¹æ“šè¡€é‡èª¿æ•´é€æ˜åº¦
                            const opacity = zombie.health / zombie.maxHealth;
                            zombieEl.style.opacity = Math.max(0.3, opacity);
                        }
                        
                        zombieEl.dataset.zombieId = zombie.id;
                        armyContainer.appendChild(zombieEl);
                    }
                });
            }

            bindEvents() {
                document.getElementById('ultimateBtn').addEventListener('click', () => this.useUltimateSkill());
                document.getElementById('healBtn').addEventListener('click', () => this.useHealSkill());
                document.getElementById('restartBtn').addEventListener('click', () => this.restartGame());
                document.getElementById('playAgainBtn').addEventListener('click', () => this.restartGame());
            }

            startZombieSkills() {
                if (this.zombieSkillTimer) {
                    clearInterval(this.zombieSkillTimer);
                }
                
                const settings = this.difficultySettings[this.difficulty];
                if (settings.skillChance > 0) {
                    this.zombieSkillTimer = setInterval(() => {
                        if (this.gameActive && Math.random() < settings.skillChance) {
                            this.activateZombieSkill();
                        }
                    }, 3000); // æ¯3ç§’æª¢æŸ¥ä¸€æ¬¡
                }
            }

            activateZombieSkill() {
                const aliveZombies = this.zombieArmy.filter(z => z.alive && z.skillCooldown <= 0);
                if (aliveZombies.length === 0) return;
                
                const zombie = aliveZombies[Math.floor(Math.random() * aliveZombies.length)];
                zombie.skillCooldown = 5; // 5ç§’å†·å»
                
                let skills = ['hide', 'shuffle', 'timeReduce', 'disguise', 'freeze', 'blind', 'confuse', 'multiply'];
                
                // Bossæœ‰é¡å¤–çš„æ–‡å­—é¡ŒæŠ€èƒ½
                if (zombie.isBoss) {
                    skills.push('textQuestion');
                }
                
                const skill = skills[Math.floor(Math.random() * skills.length)];
                
                this.executeZombieSkill(skill, zombie);
                
                // æ¸›å°‘å†·å»æ™‚é–“
                setTimeout(() => {
                    if (zombie.skillCooldown > 0) zombie.skillCooldown--;
                }, 1000);
            }

            executeZombieSkill(skill, zombie) {
                const messageEl = document.getElementById('gameMessage');
                
                switch(skill) {
                    case 'hide':
                        this.hideRandomOption();
                        messageEl.textContent = `ğŸ‘» ${zombie.type} ä½¿ç”¨éš±èº«è¡“ï¼ä¸€å€‹é¸é …è¢«éš±è—äº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-purple-600';
                        break;
                        
                    case 'shuffle':
                        this.shuffleOptions();
                        messageEl.textContent = `ğŸŒªï¸ ${zombie.type} ä½¿ç”¨æ··äº‚è¡“ï¼é¸é …è¢«æ‰“äº‚äº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-orange-600';
                        break;
                        
                    case 'timeReduce':
                        this.timeLeft = Math.max(5, this.timeLeft - 5);
                        messageEl.textContent = `â° ${zombie.type} ä½¿ç”¨æ™‚é–“è©›å’’ï¼æ™‚é–“æ¸›å°‘5ç§’ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-red-600';
                        break;
                        
                    case 'disguise':
                        this.disguiseOptions();
                        messageEl.textContent = `ğŸ­ ${zombie.type} ä½¿ç”¨å½è£è¡“ï¼é¸é …å¤–è§€æ”¹è®Šäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-blue-600';
                        break;
                        
                    case 'freeze':
                        this.freezeOptions();
                        messageEl.textContent = `â„ï¸ ${zombie.type} ä½¿ç”¨å†°å‡è¡“ï¼é¸é …è¢«å‡çµäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-cyan-600';
                        break;
                        
                    case 'blind':
                        this.blindOptions();
                        messageEl.textContent = `ğŸŒ«ï¸ ${zombie.type} ä½¿ç”¨è‡´ç›²è¡“ï¼é¸é …è®Šæ¨¡ç³Šäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-gray-600';
                        break;
                        
                    case 'confuse':
                        this.confuseOptions();
                        messageEl.textContent = `ğŸŒ€ ${zombie.type} ä½¿ç”¨æ··æ·†è¡“ï¼é¸é …åœ¨æ—‹è½‰ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-indigo-600';
                        break;
                        
                    case 'multiply':
                        this.multiplyOptions();
                        messageEl.textContent = `ğŸª ${zombie.type} ä½¿ç”¨åˆ†èº«è¡“ï¼å‡ºç¾å‡é¸é …äº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-pink-600';
                        break;
                        
                    case 'textQuestion':
                        this.forceTextQuestion();
                        messageEl.textContent = `ğŸ“š ${zombie.type} ä½¿ç”¨æ–‡å­—é¡Œï¼å‡ºç¾å¸¸è­˜å•é¡Œäº†ï¼`;
                        messageEl.className = 'text-center text-lg font-bold h-8 text-purple-600';
                        break;
                }
                

                
                // æ®­å±æŠ€èƒ½å‹•ç•«
                const zombieEl = document.querySelector(`[data-zombie-id="${zombie.id}"]`);
                if (zombieEl) {
                    zombieEl.classList.add('pulse');
                    setTimeout(() => zombieEl.classList.remove('pulse'), 1000);
                }
                
                this.updateDisplay();
                
                setTimeout(() => {
                    messageEl.textContent = '';
                }, 3000);
            }

            hideRandomOption() {
                const options = document.querySelectorAll('.option-btn:not(.hidden)');
                if (options.length <= 2) return; // è‡³å°‘ä¿ç•™2å€‹é¸é …
                
                const correctOption = document.querySelector(`[data-answer="${this.currentAnswer}"]`);
                const availableOptions = Array.from(options).filter(opt => opt !== correctOption);
                
                if (availableOptions.length > 0) {
                    const randomOption = availableOptions[Math.floor(Math.random() * availableOptions.length)];
                    randomOption.classList.add('hidden');
                    this.hiddenOptions.push(randomOption);
                    
                    // 5ç§’å¾Œæ¢å¾©
                    setTimeout(() => {
                        randomOption.classList.remove('hidden');
                        this.hiddenOptions = this.hiddenOptions.filter(opt => opt !== randomOption);
                    }, 5000);
                }
            }

            shuffleOptions() {
                const optionsArea = document.getElementById('optionsArea');
                const options = Array.from(optionsArea.children);
                
                // æ‰“äº‚é †åº
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    optionsArea.insertBefore(options[j], options[i]);
                }
            }

            disguiseOptions() {
                const options = document.querySelectorAll('.option-btn');
                const disguiseEmojis = ['ğŸª', 'ğŸ¨', 'ğŸ­', 'ğŸ¯', 'ğŸ²', 'ğŸ®', 'ğŸ¸', 'ğŸº'];
                
                options.forEach(option => {
                    const originalEmoji = option.querySelector('span').previousSibling.textContent;
                    const disguiseEmoji = disguiseEmojis[Math.floor(Math.random() * disguiseEmojis.length)];
                    option.querySelector('span').previousSibling.textContent = disguiseEmoji;
                    
                    // 3ç§’å¾Œæ¢å¾©
                    setTimeout(() => {
                        const emojis = ['ğŸ¯', 'ğŸŒŸ', 'ğŸ’', 'ğŸ”¥', 'â­', 'ğŸª', 'ğŸ¨', 'ğŸ­'];
                        const index = Array.from(options).indexOf(option);
                        option.querySelector('span').previousSibling.textContent = emojis[index % emojis.length];
                    }, 3000);
                });
            }

            freezeOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.pointerEvents = 'none';
                    option.style.opacity = '0.5';
                    option.style.filter = 'blur(1px)';
                    option.classList.add('cursor-not-allowed');
                    
                    // 3ç§’å¾Œè§£å‡
                    setTimeout(() => {
                        option.style.pointerEvents = 'auto';
                        option.style.opacity = '1';
                        option.style.filter = 'none';
                        option.classList.remove('cursor-not-allowed');
                    }, 3000);
                });
            }

            blindOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.filter = 'blur(3px)';
                    option.style.opacity = '0.7';
                    
                    // 4ç§’å¾Œæ¢å¾©è¦–åŠ›
                    setTimeout(() => {
                        option.style.filter = 'none';
                        option.style.opacity = '1';
                    }, 4000);
                });
            }

            confuseOptions() {
                const options = document.querySelectorAll('.option-btn');
                options.forEach(option => {
                    option.style.transform = 'rotate(360deg)';
                    option.style.transition = 'transform 2s ease-in-out';
                    
                    // 2ç§’å¾Œåœæ­¢æ—‹è½‰
                    setTimeout(() => {
                        option.style.transform = 'rotate(0deg)';
                        setTimeout(() => {
                            option.style.transition = '';
                        }, 500);
                    }, 2000);
                });
            }

            multiplyOptions() {
                const optionsArea = document.getElementById('optionsArea');
                const existingOptions = Array.from(optionsArea.children);
                const fakeOptions = [];
                
                // å‰µå»º2å€‹å‡é¸é …
                for (let i = 0; i < 2; i++) {
                    const fakeOption = existingOptions[0].cloneNode(true);
                    const fakeAnswer = Math.floor(Math.random() * 100);
                    fakeOption.querySelector('span').textContent = fakeAnswer;
                    fakeOption.dataset.answer = fakeAnswer;
                    fakeOption.style.opacity = '0.8';
                    fakeOption.style.border = '2px dashed #666';
                    
                    // å‡é¸é …é»æ“Šç„¡æ•ˆæœ
                    fakeOption.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const messageEl = document.getElementById('gameMessage');
                        messageEl.textContent = 'ğŸ‘» é€™æ˜¯å‡é¸é …ï¼';
                        messageEl.className = 'text-center text-lg font-bold h-8 text-gray-600';
                        setTimeout(() => messageEl.textContent = '', 1000);
                    });
                    
                    optionsArea.appendChild(fakeOption);
                    fakeOptions.push(fakeOption);
                }
                
                // 5ç§’å¾Œç§»é™¤å‡é¸é …
                setTimeout(() => {
                    fakeOptions.forEach(fake => {
                        if (fake.parentNode) {
                            fake.parentNode.removeChild(fake);
                        }
                    });
                }, 5000);
            }

            forceTextQuestion() {
                // å¼·åˆ¶ä¸‹ä¸€é¡Œç‚ºæ–‡å­—é¡Œ
                setTimeout(() => {
                    if (this.gameActive) {
                        this.generateTextQuestion();
                    }
                }, 1000);
            }

            startQuestionTimer() {
                this.questionStartTime = Date.now();
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }
                
                // 5ç§’å¾Œå¦‚æœæ²’æœ‰é¸æ“‡ç­”æ¡ˆï¼Œå°±æ‰“äº‚é¸é …
                this.questionTimer = setTimeout(() => {
                    if (this.gameActive) {
                        this.shuffleOptions();
                        const messageEl = document.getElementById('gameMessage');
                        messageEl.textContent = 'â° æ™‚é–“å¤ªä¹…äº†ï¼é¸é …è¢«æ‰“äº‚äº†ï¼';
                        messageEl.className = 'text-center text-lg font-bold h-8 text-orange-600';
                        
                        setTimeout(() => {
                            messageEl.textContent = '';
                        }, 2000);
                    }
                }, 5000);
            }

            forceTextQuestion() {
                // å¼·åˆ¶ä¸‹ä¸€é¡Œç‚ºæ–‡å­—é¡Œ
                setTimeout(() => {
                    if (this.gameActive) {
                        this.generateTextQuestion();
                    }
                }, 1000);
            }

            generateQuestion() {
                // 20% æ©Ÿç‡å‡ºç¾æ–‡å­—é¡Œ (é—œå¡3ä»¥ä¸Š)
                const shouldUseTextQuestion = this.level >= 3 && Math.random() < 0.2;
                
                if (shouldUseTextQuestion) {
                    this.generateTextQuestion();
                } else {
                    this.generateMathQuestion();
                }
            }

            generateTextQuestion() {
                this.currentQuestionType = 'text';
                const modeQuestions = this.textQuestions[this.gameMode];
                const textQuestion = modeQuestions[Math.floor(Math.random() * modeQuestions.length)];
                
                this.currentAnswer = textQuestion.answer;
                document.getElementById('question').textContent = textQuestion.question;
                
                // ä½¿ç”¨é è¨­é¸é …
                let options = [...textQuestion.options];
                
                // éš¨æ©Ÿæ’åˆ—é¸é …
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                this.renderOptions(options);
                this.startQuestionTimer();
            }

            generateMathQuestion() {
                this.currentQuestionType = 'math';
                const num1 = Math.floor(Math.random() * 9) + 1;
                const num2 = Math.floor(Math.random() * 9) + 1;
                let questionText = '';
                let maxAnswer = 18;
                
                if (this.gameMode === 'multiplication') {
                    // ä¹ä¹ä¹˜æ³•è¡¨
                    this.currentAnswer = num1 * num2;
                    questionText = `${num1} Ã— ${num2} = ?`;
                    maxAnswer = 81;
                } else if (this.gameMode === 'addSub') {
                    // å–®ä½æ•¸åŠ æ¸›
                    const isAddition = Math.random() < 0.5;
                    if (isAddition) {
                        this.currentAnswer = num1 + num2;
                        questionText = `${num1} + ${num2} = ?`;
                    } else {
                        const larger = Math.max(num1, num2);
                        const smaller = Math.min(num1, num2);
                        this.currentAnswer = larger - smaller;
                        questionText = `${larger} - ${smaller} = ?`;
                    }
                } else if (this.gameMode === 'mixed') {
                    // æ··åˆæ¨¡å¼
                    const operation = Math.floor(Math.random() * 3);
                    if (operation === 0) {
                        // ä¹˜æ³•
                        this.currentAnswer = num1 * num2;
                        questionText = `${num1} Ã— ${num2} = ?`;
                        maxAnswer = 81;
                    } else if (operation === 1) {
                        // åŠ æ³•
                        this.currentAnswer = num1 + num2;
                        questionText = `${num1} + ${num2} = ?`;
                    } else {
                        // æ¸›æ³•
                        const larger = Math.max(num1, num2);
                        const smaller = Math.min(num1, num2);
                        this.currentAnswer = larger - smaller;
                        questionText = `${larger} - ${smaller} = ?`;
                    }
                }
                
                document.getElementById('question').textContent = questionText;
                
                // æ ¹æ“šé—œå¡å¢åŠ é¸é …æ•¸é‡ (4-8å€‹é¸é …)
                this.optionCount = Math.min(4 + Math.floor((this.level - 1) / 2), 8);
                
                // ç”Ÿæˆé¸é …
                const options = [this.currentAnswer];
                while (options.length < this.optionCount) {
                    const wrongAnswer = Math.floor(Math.random() * (maxAnswer + 1));
                    if (!options.includes(wrongAnswer)) {
                        options.push(wrongAnswer);
                    }
                }
                
                // éš¨æ©Ÿæ’åˆ—é¸é …
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                this.renderOptions(options);
                this.startQuestionTimer();
            }

            renderOptions(options) {
                const optionsArea = document.getElementById('optionsArea');
                optionsArea.innerHTML = '';
                
                // æ ¹æ“šé¸é …æ•¸é‡èª¿æ•´ç¶²æ ¼
                const gridCols = this.optionCount <= 4 ? 'grid-cols-2' : 
                                this.optionCount <= 6 ? 'grid-cols-3' : 'grid-cols-4';
                optionsArea.className = `grid ${gridCols} gap-4 mb-6`;
                
                const emojis = ['ğŸ¯', 'ğŸŒŸ', 'ğŸ’', 'ğŸ”¥', 'â­', 'ğŸª', 'ğŸ¨', 'ğŸ­'];
                
                options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = `option-btn bg-gradient-to-r ${this.optionColors[index % this.optionColors.length]} text-white p-4 rounded-xl text-2xl font-bold transition-all shadow-lg transform hover:scale-105 hover:shadow-xl`;
                    btn.innerHTML = `${emojis[index % emojis.length]}<br><span class="text-3xl">${option}</span>`;
                    btn.dataset.answer = option;
                    btn.addEventListener('click', (e) => {
                        const answer = e.currentTarget.dataset.answer;
                        // è™•ç†æ–‡å­—ç­”æ¡ˆå’Œæ•¸å­—ç­”æ¡ˆ
                        const parsedAnswer = isNaN(answer) ? answer : parseInt(answer);
                        this.selectAnswer(parsedAnswer);
                    });
                    optionsArea.appendChild(btn);
                });
            }

            selectAnswer(selectedAnswer) {
                if (!this.gameActive) return;
                
                // æ¸…é™¤å•é¡Œè¨ˆæ™‚å™¨
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }
                
                // è™•ç†å­—ç¬¦ä¸²å’Œæ•¸å­—çš„æ¯”è¼ƒ
                const isCorrect = String(selectedAnswer) === String(this.currentAnswer);
                const messageEl = document.getElementById('gameMessage');
                
                if (isCorrect) {
                    this.correctStreak++; // å¢åŠ é€£çºŒç­”å°æ¬¡æ•¸
                    
                    // åŸºç¤åˆ†æ•¸
                    let baseScore = 10 + (this.level * 5);
                    
                    // é€£çºŒç­”å°çå‹µ
                    let streakBonus = Math.floor(this.correctStreak / 3) * 10;
                    
                    // æœƒå¿ƒä¸€æ“Š (15% æ©Ÿç‡)
                    const isCritical = Math.random() < 0.15;
                    let criticalMultiplier = 1;
                    if (isCritical) {
                        criticalMultiplier = 2;
                    }
                    
                    const totalScore = (baseScore + streakBonus) * criticalMultiplier;
                    this.score += totalScore;
                    
                    this.timeLeft += 5; // æ”»æ“ŠæˆåŠŸåŠ 5ç§’æ™‚é–“
                    
                    // é€£çºŒç­”å°è£œè¡€ (æ¯3é¡Œç­”å°è£œè¡€)
                    if (this.correctStreak % 3 === 0) {
                        this.plantHealth = Math.min(100, this.plantHealth + 15);
                    }
                    
                    this.attackZombies(isCritical);
                    

                    
                    // é¡¯ç¤ºè¨Šæ¯
                    let message = 'ğŸ¯ æ­£ç¢ºï¼';
                    if (isCritical) {
                        message += ' ğŸ’¥ æœƒå¿ƒä¸€æ“Šï¼';
                    }
                    if (this.correctStreak % 3 === 0) {
                        message += ' ğŸ’– é€£çºŒç­”å°è£œè¡€ï¼';
                    }
                    message += ' â° +5ç§’';
                    
                    messageEl.textContent = message;
                    messageEl.className = isCritical ? 
                        'text-center text-lg font-bold h-8 text-yellow-600' : 
                        'text-center text-lg font-bold h-8 text-green-600';
                    
                    // æ¤ç‰©æ”»æ“Šå‹•ç•«
                    document.getElementById('plantChar').classList.add('bounce');
                    if (isCritical) {
                        document.getElementById('plantChar').classList.add('glow');
                    }
                    
                    // éš¨æ©Ÿæ›´æ›æ¤ç‰©
                    document.getElementById('plantChar').textContent = this.plants[Math.floor(Math.random() * this.plants.length)];
                    
                } else {
                    this.correctStreak = 0; // é‡ç½®é€£çºŒç­”å°æ¬¡æ•¸
                    const damage = 10 + this.level * 2;
                    this.plantHealth = Math.max(0, this.plantHealth - damage); // é—œå¡è¶Šé«˜å‚·å®³è¶Šå¤§
                    

                    
                    messageEl.textContent = 'âŒ éŒ¯èª¤ï¼æ®­å±è»åœ˜åæ“Šäº†ï¼';
                    messageEl.className = 'text-center text-lg font-bold h-8 text-red-600';
                    
                    // æ®­å±æ”»æ“Šå‹•ç•«
                    document.getElementById('plantChar').classList.add('shake');
                    this.animateZombieAttack();
                }
                
                // æ¸…é™¤å‹•ç•«
                setTimeout(() => {
                    document.getElementById('plantChar').classList.remove('bounce', 'shake', 'glow');
                    document.querySelectorAll('.zombie-unit').forEach(z => z.classList.remove('bounce', 'shake'));
                }, 600);
                
                this.updateDisplay();
                
                // æª¢æŸ¥éŠæˆ²çµæŸæ¢ä»¶
                if (this.plantHealth <= 0) {
                    this.endGame('defeat');
                    return;
                } else if (this.getAliveZombieCount() === 0) {
                    this.nextLevel();
                    return;
                }
                
                // åªæœ‰ç­”å°æ‰ç”Ÿæˆæ–°é¡Œç›®
                if (isCorrect) {
                    setTimeout(() => {
                        this.generateQuestion();
                        messageEl.textContent = '';
                    }, 1500);
                } else {
                    setTimeout(() => {
                        messageEl.textContent = '';
                    }, 1500);
                }
            }

            attackZombies(isCritical = false) {
                const aliveZombies = this.zombieArmy.filter(z => z.alive);
                if (aliveZombies.length === 0) return;
                
                // éš¨æ©Ÿæ”»æ“Šä¸€éš»æ®­å±
                const targetZombie = aliveZombies[Math.floor(Math.random() * aliveZombies.length)];
                
                // Bosså—åˆ°çš„å‚·å®³è¼ƒå°‘ï¼Œæœƒå¿ƒä¸€æ“Šå‚·å®³åŠ å€
                let damage = targetZombie.isBoss ? 20 : 30;
                if (isCritical) {
                    damage *= 2;
                }
                
                targetZombie.health -= damage;
                
                if (targetZombie.health <= 0) {
                    targetZombie.alive = false;
                    targetZombie.health = 0;
                }
                
                // æ·»åŠ æ”»æ“Šå‹•ç•«
                const zombieEl = document.querySelector(`[data-zombie-id="${targetZombie.id}"]`);
                if (zombieEl) {
                    zombieEl.classList.add('shake');
                    if (isCritical) {
                        zombieEl.style.filter = 'brightness(2) saturate(2)';
                        setTimeout(() => {
                            zombieEl.style.filter = '';
                        }, 500);
                    }
                }
                
                this.renderZombieArmy();
            }

            animateZombieAttack() {
                const aliveZombieEls = document.querySelectorAll('.zombie-unit');
                aliveZombieEls.forEach(el => {
                    el.classList.add('bounce');
                });
            }

            getAliveZombieCount() {
                return this.zombieArmy.filter(z => z.alive).length;
            }

            nextLevel() {
                // æ–°å¢é—œå¡å®Œæˆæ­·å²ç´€éŒ„
                this.addToHistory(`é—œå¡ ${this.level} å®Œæˆï¼æº–å‚™é€²å…¥ä¸‹ä¸€é—œ`, 'success');
                
                this.level++;
                this.timeLeft = Math.max(15, 25 - Math.floor((this.level - 1) / 2) * 2); // æ™‚é–“è¶Šä¾†è¶Šå°‘ä½†æ›´åˆç†
                
                // é¡¯ç¤ºéå ´å‹•ç•«
                this.showTransition();
            }
            addToHistory () {
            }
            
            showTransition() {
                // æš«åœè¨ˆæ™‚å™¨é¿å…éå ´å‹•ç•«æ‰£æ™‚é–“
                if (this.timer) {
                    clearInterval(this.timer);
                }
                
                const gameArea = document.getElementById('gameArea');
                const transitionScreen = document.getElementById('transitionScreen');
                const transitionEmoji = document.getElementById('transitionEmoji');
                const transitionTitle = document.getElementById('transitionTitle');
                const transitionMessage = document.getElementById('transitionMessage');
                const transitionHint = document.getElementById('transitionHint');
                
                gameArea.classList.add('hidden');
                transitionScreen.classList.remove('hidden');
                
                // æ ¹æ“šé—œå¡é¡å‹è¨­ç½®ä¸åŒçš„éå ´æ•ˆæœ
                if (this.isBossLevel()) {
                    const boss = this.bossTypes[this.level];
                    transitionScreen.className = this.level === 10 ? 
                        'final-boss-bg rounded-xl p-8 shadow-2xl text-center' :
                        'boss-bg rounded-xl p-8 shadow-2xl text-center';
                    
                    transitionEmoji.textContent = boss.emoji;
                    transitionTitle.textContent = `Bossæˆ°ï¼`;
                    transitionMessage.textContent = `${boss.name} å‡ºç¾äº†ï¼`;
                    transitionHint.textContent = this.level === 10 ? 
                        'é€™æ˜¯æœ€çµ‚æ±ºæˆ°ï¼' : 
                        'å°å¿ƒï¼Bossçš„è¡€é‡å¾ˆåšï¼';
                } else {
                    transitionScreen.className = 'bg-gradient-to-b from-purple-900 via-blue-900 to-black rounded-xl p-8 shadow-2xl text-center';
                    transitionEmoji.textContent = 'ğŸŒŸ';
                    transitionTitle.textContent = `é—œå¡ ${this.level}`;
                    transitionMessage.textContent = 'æº–å‚™è¿æ¥ä¸‹ä¸€æ³¢æŒ‘æˆ°ï¼';
                    transitionHint.textContent = 'æ®­å±è»åœ˜è¶Šä¾†è¶Šå¼·å¤§äº†...';
                }
                
                // 3ç§’å¾Œé–‹å§‹æ–°é—œå¡
                setTimeout(() => {
                    transitionScreen.classList.add('hidden');
                    gameArea.classList.remove('hidden');
                    this.createZombieArmy();
                    this.generateQuestion();
                    this.updateGameAreaStyle();
                    // é‡æ–°å•Ÿå‹•è¨ˆæ™‚å™¨
                    this.startTimer();
                }, 3000);
            }

            updateGameAreaStyle() {
                const gameArea = document.getElementById('gameArea');
                
                if (this.isBossLevel()) {
                    if (this.level === 10) {
                        gameArea.className = 'final-boss-bg rounded-xl p-8 shadow-2xl';
                    } else {
                        gameArea.className = 'boss-bg rounded-xl p-8 shadow-2xl';
                    }
                } else {
                    gameArea.className = 'bg-white/95 rounded-xl p-8 shadow-2xl';
                }
            }

            useUltimateSkill() {
                if (this.ultimateSkills <= 0 || !this.gameActive) return;
                
                this.ultimateSkills--;
                this.score += 50;
                this.plantHealth = Math.min(100, this.plantHealth + 30);
                
                // å¿…æ®ºæŠ€ä½¿ç”¨å¾Œå›å¾©æ²»ç™‚æŠ€èƒ½
                this.healSkills = Math.min(5, this.healSkills + 1);
                
                // å°æ‰€æœ‰æ´»è‘—çš„æ®­å±é€ æˆå‚·å®³
                let totalDamage = 0;
                this.zombieArmy.forEach(zombie => {
                    if (zombie.alive) {
                        // Bosså—åˆ°çš„å¿…æ®ºæŠ€å‚·å®³è¼ƒå°‘
                        const damage = zombie.isBoss ? 30 : 50;
                        zombie.health -= damage;
                        totalDamage += damage;
                        if (zombie.health <= 0) {
                            zombie.alive = false;
                            zombie.health = 0;
                        }
                    }
                });
                
                // æ–°å¢å¿…æ®ºæŠ€ä½¿ç”¨æ­·å²ç´€éŒ„
                this.addToHistory(`ä½¿ç”¨å¿…æ®ºæŠ€ï¼é€ æˆ ${totalDamage} é»ç¾¤é«”å‚·å®³ï¼Œå›å¾©30è¡€é‡ï¼Œæ²»ç™‚æŠ€èƒ½+1`, 'skill');
                
                const messageEl = document.getElementById('gameMessage');
                messageEl.textContent = 'âš¡ å¿…æ®ºæŠ€ç™¼å‹•ï¼é™½å…‰ç‚¸å½ˆç¾¤é«”æ”»æ“Šï¼ğŸ’– æ²»ç™‚æŠ€èƒ½+1';
                messageEl.className = 'text-center text-lg font-bold h-8 text-yellow-600';
                
                // ç‰¹æ•ˆå‹•ç•«
                document.getElementById('plantChar').classList.add('glow');
                document.querySelectorAll('.zombie-unit').forEach(el => {
                    el.classList.add('shake');
                });
                
                setTimeout(() => {
                    document.getElementById('plantChar').classList.remove('glow');
                    document.querySelectorAll('.zombie-unit').forEach(el => {
                        el.classList.remove('shake');
                    });
                    messageEl.textContent = '';
                }, 2000);
                
                this.renderZombieArmy();
                this.updateDisplay();
                
                if (this.getAliveZombieCount() === 0) {
                    this.nextLevel();
                }
            }

            useHealSkill() {
                if (this.healSkills <= 0 || !this.gameActive) return;
                
                this.healSkills--;
                this.plantHealth = Math.min(100, this.plantHealth + 50);
                this.timeLeft += 10; // é¡å¤–çå‹µæ™‚é–“
                
                // æ²»ç™‚æŠ€èƒ½ä½¿ç”¨å¾Œå›å¾©å¿…æ®ºæŠ€
                this.ultimateSkills = Math.min(3, this.ultimateSkills + 1);
                
                // æ–°å¢æ²»ç™‚æŠ€èƒ½ä½¿ç”¨æ­·å²ç´€éŒ„
                this.addToHistory('ä½¿ç”¨æ²»ç™‚è¡“ï¼å›å¾©50è¡€é‡ï¼Œæ™‚é–“+10ç§’ï¼Œå¿…æ®ºæŠ€+1', 'skill');
                
                const messageEl = document.getElementById('gameMessage');
                messageEl.textContent = 'ğŸ’– æ²»ç™‚è¡“ç™¼å‹•ï¼æ¤ç‰©æ¢å¾©å¥åº·ï¼â° +10ç§’ âš¡ å¿…æ®ºæŠ€+1';
                messageEl.className = 'text-center text-lg font-bold h-8 text-pink-600';
                
                // æ²»ç™‚ç‰¹æ•ˆå‹•ç•«
                document.getElementById('plantChar').classList.add('bounce');
                
                setTimeout(() => {
                    document.getElementById('plantChar').classList.remove('bounce');
                    messageEl.textContent = '';
                }, 2000);
                
                this.updateDisplay();
            }

            startTimer() {
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    this.updateDisplay();
                    
                    if (this.timeLeft <= 0) {
                        // æ™‚é–“åˆ°æ‰£è¡€è€Œä¸æ˜¯ç›´æ¥çµæŸéŠæˆ²
                        this.plantHealth = Math.max(0, this.plantHealth - 20);
                        this.timeLeft = Math.max(10, 20 - Math.floor(this.level / 3) * 2); // é‡ç½®æ™‚é–“ï¼Œé—œå¡è¶Šé«˜æ™‚é–“è¶Šå°‘
                        
                        const messageEl = document.getElementById('gameMessage');
                        messageEl.textContent = 'â° æ™‚é–“åˆ°ï¼æ¤ç‰©å—åˆ°å‚·å®³ï¼';
                        messageEl.className = 'text-center text-lg font-bold h-8 text-red-600';
                        
                        // æ¤ç‰©å—å‚·å‹•ç•«
                        document.getElementById('plantChar').classList.add('shake');
                        
                        setTimeout(() => {
                            document.getElementById('plantChar').classList.remove('shake');
                            messageEl.textContent = '';
                        }, 1500);
                        
                        this.updateDisplay();
                        
                        // æª¢æŸ¥æ˜¯å¦è¡€é‡æ­¸é›¶
                        if (this.plantHealth <= 0) {
                            this.endGame('defeat');
                        }
                    }
                }, 1000);
            }

            updateDisplay() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('timer').textContent = this.timeLeft;
                document.getElementById('questionCount').textContent = this.level;
                document.getElementById('zombieCount').textContent = this.getAliveZombieCount();
                document.getElementById('streakCount').textContent = this.correctStreak;
                document.getElementById('ultimateCount').textContent = this.ultimateSkills;
                document.getElementById('healCount').textContent = this.healSkills;
                document.getElementById('plantHealth').style.width = this.plantHealth + '%';
                document.getElementById('zombieStatus').textContent = `${this.getAliveZombieCount()}éš»æ®­å±å‰©é¤˜`;
                
                // è¡€é‡ä¸è¶³è­¦å‘Š
                const plantHealthBar = document.getElementById('plantHealth');
                if (this.plantHealth <= 30) {
                    plantHealthBar.className = 'h-full bg-red-500 transition-all duration-500 animate-pulse';
                    if (this.plantHealth <= 30 && this.plantHealth > 0) {
                        const messageEl = document.getElementById('gameMessage');
                        if (!messageEl.textContent.includes('è¡€é‡å±éšª')) {
                            messageEl.textContent = 'âš ï¸ è¡€é‡å±éšªï¼å¿«ä½¿ç”¨æ²»ç™‚è¡“ï¼';
                            messageEl.className = 'text-center text-lg font-bold h-8 text-red-600 animate-pulse';
                            setTimeout(() => {
                                if (messageEl.textContent.includes('è¡€é‡å±éšª')) {
                                    messageEl.textContent = '';
                                }
                            }, 3000);
                        }
                    }
                } else if (this.plantHealth <= 50) {
                    plantHealthBar.className = 'h-full bg-yellow-500 transition-all duration-500';
                } else {
                    plantHealthBar.className = 'h-full bg-green-500 transition-all duration-500';
                }
                
                // æ›´æ–°å¿…æ®ºæŠ€æŒ‰éˆ•ç‹€æ…‹
                const ultimateBtn = document.getElementById('ultimateBtn');
                if (this.ultimateSkills <= 0) {
                    ultimateBtn.disabled = true;
                    ultimateBtn.classList.add('opacity-50');
                    ultimateBtn.classList.remove('glow');
                } else {
                    ultimateBtn.disabled = false;
                    ultimateBtn.classList.remove('opacity-50');
                }
                
                // æ›´æ–°æ²»ç™‚æŠ€èƒ½æŒ‰éˆ•ç‹€æ…‹
                const healBtn = document.getElementById('healBtn');
                if (this.healSkills <= 0) {
                    healBtn.disabled = true;
                    healBtn.classList.add('opacity-50');
                } else {
                    healBtn.disabled = false;
                    healBtn.classList.remove('opacity-50');
                }
            }

            endGame(reason) {
                this.gameActive = false;
                clearInterval(this.timer);
                if (this.zombieSkillTimer) {
                    clearInterval(this.zombieSkillTimer);
                }
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }
                
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('gameOverScreen').classList.remove('hidden');
                
                const gameOverEmoji = document.getElementById('gameOverEmoji');
                const gameOverTitle = document.getElementById('gameOverTitle');
                const gameOverMessage = document.getElementById('gameOverMessage');
                
                switch (reason) {
                    case 'victory':
                        gameOverEmoji.textContent = 'ğŸ‰';
                        gameOverTitle.textContent = 'å‹åˆ©ï¼';
                        gameOverMessage.textContent = 'ä½ æˆåŠŸæ“Šæ•—äº†æ•¸å­¸æ®­å±ï¼';
                        break;
                    case 'defeat':
                        gameOverEmoji.textContent = 'ğŸ’€';
                        gameOverTitle.textContent = 'å¤±æ•—ï¼';
                        gameOverMessage.textContent = 'æ®­å±æ”»ç ´äº†é˜²ç·š...å†è©¦ä¸€æ¬¡å§ï¼';
                        break;
                    case 'timeout':
                        gameOverEmoji.textContent = 'â°';
                        gameOverTitle.textContent = 'æ™‚é–“åˆ°ï¼';
                        gameOverMessage.textContent = 'æ™‚é–“ç”¨å®Œäº†ï¼å¿«é€Ÿè¨ˆç®—æ˜¯é—œéµï¼';
                        break;
                    case 'complete':
                        gameOverEmoji.textContent = 'ğŸ†';
                        gameOverTitle.textContent = 'å®Œæˆï¼';
                        gameOverMessage.textContent = 'ä½ å®Œæˆäº†æ‰€æœ‰é¡Œç›®ï¼çœŸå²å®³ï¼';
                        break;
                }
                
                document.getElementById('finalScore').textContent = `æœ€çµ‚åˆ†æ•¸: ${this.score}`;
            }

            restartGame() {
                // é‡ç½®æ‰€æœ‰æ•¸å€¼
                this.score = 0;
                this.timeLeft = 30;
                this.level = 1;
                this.ultimateSkills = 3;
                this.healSkills = 5;
                this.plantHealth = 100;
                this.zombieArmy = [];
                this.optionCount = 4;
                this.gameActive = false;
                this.gameMode = null;
                this.difficulty = null;
                this.hiddenOptions = [];
                this.correctStreak = 0;
                
                if (this.timer) {
                    clearInterval(this.timer);
                }
                if (this.zombieSkillTimer) {
                    clearInterval(this.zombieSkillTimer);
                }
                if (this.questionTimer) {
                    clearTimeout(this.questionTimer);
                }
                
                // é‡ç½®è§’è‰²
                document.getElementById('plantChar').textContent = 'ğŸŒ»';
                
                // é‡ç½®æ¨™é¡Œ
                document.getElementById('gameSubtitle').textContent = 'æ•¸å­¸å¤§ä½œæˆ°';
                
                // é¡¯ç¤ºæ¨¡å¼é¸æ“‡ï¼Œéš±è—å…¶ä»–ç•«é¢
                document.getElementById('modeSelection').classList.remove('hidden');
                document.getElementById('difficultySelection').classList.add('hidden');
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('gameOverScreen').classList.add('hidden');
                document.getElementById('transitionScreen').classList.add('hidden');
                
                // é‡ç½®éŠæˆ²å€åŸŸæ¨£å¼
                document.getElementById('gameArea').className = 'bg-white/95 rounded-xl p-8 shadow-2xl hidden';
            }
        }

        // å•Ÿå‹•éŠæˆ²
        window.addEventListener('DOMContentLoaded', () => {
            new MathZombieGame();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97828fc5e1f6dc87',t:'MTc1NjcwNjU3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
